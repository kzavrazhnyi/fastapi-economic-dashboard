# FastAPI Economic Dashboard

Проєкт для генерації демо-даних з економетричної статистики для торгівельно-виробничого підприємства з інтерактивною веб-візуалізацією та інтеграцією даних Світового банку.

## Правила проєкту

- **Операційна система**: Windows
- **Термінал**: PowerShell
- **Мова коментарів**: Англійська
- **Віртуальне середовище**: venv
- **База даних**: SQLite (з підтримкою PostgreSQL в майбутньому)
- **Кодування**: UTF-8 для всіх файлів
- **Роздільники команд**: Використовувати `;` замість `&&` в PowerShell
- **Оператор &&**: НЕ використовувати `&&` в командах PowerShell
 - **Коміти в Git**: коміти виконувати ТІЛЬКИ за прямою командою користувача ("зроби коміт/передай в гітхаб"). Автоматичних комітів не робити.

## Встановлення та запуск

### 1. Активація віртуального середовища
```powershell
venv\Scripts\Activate.ps1
```

### 2. Встановлення залежностей
```powershell
pip install -r requirements.txt
```

### 3. Запуск сервера
```powershell
# Варіант 1: Простий запуск (рекомендовано)
python start_simple.py

# Варіант 2: Прямий запуск через venv
venv\Scripts\python.exe run_server.py

# Варіант 3: Через batch файл з UTF-8
start_server_utf8.bat

# Варіант 4: Через PowerShell скрипт
powershell -ExecutionPolicy Bypass -File start_server.ps1

# Варіант 5: Прямий запуск uvicorn
venv\Scripts\python.exe -m uvicorn app.main:app --reload
```

### 4. Доступ до додатку
- Веб-інтерфейс: http://localhost:8000
- API документація: http://localhost:8000/docs
- Альтернативна документація: http://localhost:8000/redoc

## Структура проєкту

```
fastapi-economic-dashboard/
├── venv/                    # Віртуальне середовище
├── app/
│   ├── __init__.py         # Python пакет
│   ├── main.py             # FastAPI додаток
│   ├── data_generator.py   # Генератор демо-даних
│   ├── models.py           # Моделі даних
│   ├── worldbank_client.py # Клієнт World Bank API
│   ├── crypto_client.py    # Клієнт криптовалютного API
│   └── static/
│       ├── index.html      # Веб-інтерфейс
│       └── docs.html       # Технічна документація
├── data/                   # Згенеровані CSV файли
├── scripts/                # Тестові скрипти
├── plan/                   # План проекту
├── requirements.txt        # Залежності Python
├── run_server.py          # Скрипт запуску сервера
├── start_simple.py        # Простий скрипт запуску
├── start_server_utf8.py   # Скрипт з UTF-8
├── render_start.py        # Скрипт для Render
├── gunicorn.conf.py       # Конфігурація Gunicorn
├── render.yaml            # Конфігурація Render
├── README.md              # Документація
└── VERSION.md             # Версії та залежності
```

## Функціональність

### Основні можливості
- **Генерація демо-даних**: продажі, запаси, собівартість, прибуток
- **REST API**: повний набір ендпоінтів для роботи з даними
- **Інтерактивна візуалізація**: графіки та діаграми з Plotly.js
- **Дашборд**: KPI метрики та аналітика в реальному часі
- **Перегляд файлів**: інтерактивний перегляд CSV файлів з пагінацією
- **Статистика файлів**: детальний аналіз структури та змісту даних

### Інтеграції з зовнішніми API
- **World Bank API**: економічні показники країн світу
- **CoinGecko API**: дані про криптовалюти та ринкові метрики
- **Кешування**: автоматичне кешування даних для оптимізації
- **Fallback**: використання збережених даних при недоступності API

## Функції аналізу економічних даних

### Нормалізація даних
Проєкт включає функції для нормалізації економічних показників:

- **ВВП**: конвертується в мільярди доларів США
- **ВВП на душу**: залишається в доларах
- **Експорт/Імпорт**: конвертується в мільярди доларів
- **Населення**: конвертується в мільйони осіб
- **Інфляція та безробіття**: залишаються у відсотках

### Конвертація валют
Підтримується конвертація в основні валюти:
- USD (долар США) - базова валюта
- EUR (євро)
- UAH (гривня)
- PLN (злотий)
- GBP (фунт стерлінгів)
- JPY (єна)
- CNY (юань)

### Аналіз економічного здоров'я
Система оцінює економічне здоров'я країн за методологією:

- **ВВП на душу населення** (30% ваги) - показник економічного розвитку
- **Інфляція** (25% ваги) - стабільність цін
- **Безробіття** (25% ваги) - зайнятість населення  
- **Очікувана тривалість життя** (20% ваги) - якість життя

**Рівні оцінки:**
- Відмінний: 80-100 балів
- Добрий: 60-79 балів
- Середній: 40-59 балів
- Поганий: 20-39 балів
- Критичний: 0-19 балів

### Автоматичний деплой через GitHub

1. **Підключіть репозиторій до Render**:
   - Перейдіть на [render.com](https://render.com)
   - Натисніть "New +" → "Web Service"
   - Підключіть GitHub репозиторій: `https://github.com/kzavrazhnyi/fastapi-economic-dashboard`

2. **Налаштування сервісу**:
   - **Name**: `fastapi-economic-dashboard`
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python run_server.py`
   - **Plan**: `Free` (або `Starter` для кращої продуктивності)

3. **Змінні середовища** (опціонально):
   - `PYTHON_VERSION`: `3.11.0`
   - `PORT`: `8000` (автоматично встановлюється Render)
   - `RENDER`: `true` (для визначення продакшен середовища)

4. **Health Check**: Render автоматично перевіряє `/` endpoint

### Альтернативні команди запуску

Якщо основна команда не працює, спробуйте:

```bash
# Варіант 1: Через render_start.py
python render_start.py

# Варіант 2: Через Gunicorn
gunicorn -c gunicorn.conf.py app.main:app

# Варіант 3: Прямий uvicorn
uvicorn app.main:app --host 0.0.0.0 --port $PORT
```

### Перевірка деплою

Після успішного деплою ваш додаток буде доступний за URL:
- **Веб-інтерфейс**: `https://your-app-name.onrender.com`
- **API документація**: `https://your-app-name.onrender.com/docs`

## API Ендпоінти

### Основні дані
- `GET /` - головна сторінка з візуалізацією
- `GET /api/sales` - дані про продажі (з фільтрами за датою, категорією, регіоном)
- `GET /api/inventory` - дані про запаси (з фільтрами за категорією, низькими запасами)
- `GET /api/profit` - дані про прибутковість (з фільтрами за категорією, мінімальною маржею)
- `GET /api/trends` - часові ряди (з агрегацією за періодом)
- `GET /api/stats` - загальна статистика (KPI метрики)
- `GET /api/categories` - список категорій продуктів
- `GET /api/regions` - список регіонів продажу

### Робота з файлами
- `GET /api/files` - список файлів даних
- `GET /api/files/{filename}` - вміст CSV файлу з пагінацією
- `GET /api/files/{filename}/stats` - статистика CSV файлу
- `POST /api/regenerate` - регенерація всіх даних

### World Bank API
- `GET /api/worldbank/countries` - список доступних країн
- `GET /api/worldbank/indicators-list` - список доступних показників
- `GET /api/worldbank/indicators` - економічні показники країн
- `GET /api/worldbank/normalized` - нормалізовані економічні дані
- `GET /api/worldbank/economic-health` - аналіз економічного здоров'я
- `GET /api/worldbank/comparison` - порівняння країн за показниками
- `GET /api/worldbank/trends/{country}` - аналіз трендів для країни
- `GET /api/worldbank/currency-rates` - курси валют для конвертації
- `POST /api/clear-cache` - очищення кешу World Bank API

### Криптовалютні дані
- `GET /api/crypto/markets` - ринкові дані топ криптовалют
- `GET /api/crypto/coins/{coin_id}/history` - історичні дані криптовалюти
- `GET /api/crypto/global` - глобальні метрики ринку криптовалют

### Системні
- `GET /api/server-logs` - серверні логи
- `GET /docs` - інтерактивна документація API (Swagger UI)
- `GET /redoc` - альтернативна документація API

## Технічні особливості

### Архітектура
- **FastAPI** - сучасний веб-фреймворк з автоматичною документацією
- **Pydantic** - валідація даних та серіалізація
- **Pandas** - обробка та аналіз даних
- **Plotly.js** - інтерактивна візуалізація
- **Bootstrap** - адаптивний дизайн

### Кешування та оптимізація
- **In-memory кеш** - кешування API відповідей на 30 хвилин
- **localStorage** - збереження даних в браузері для offline режиму
- **Пагінація** - обмеження кількості записів для продуктивності
- **Lazy loading** - завантаження даних за запитом

### Обробка помилок
- **Fallback механізми** - використання кешованих даних при недоступності API
- **Graceful degradation** - показ зразкових даних при проблемах з API
- **Детальне логування** - відстеження всіх операцій для дебагу
- **Валідація даних** - перевірка коректності вхідних параметрів

### Безпека
- **CORS** - налаштований для роботи з фронтендом
- **Валідація параметрів** - перевірка всіх вхідних даних
- **Rate limiting** - обмеження частоти запитів до зовнішніх API
- **Error handling** - безпечна обробка помилок без витоку інформації

## Тестування

### Запуск тестів
```powershell
# Тестування World Bank API клієнта
python scripts/test_worldbank_client.py

# Тестування ендпоінтів World Bank API
python scripts/test_worldbank_endpoints.py

# Запуск всіх тестів через PowerShell скрипт
powershell -ExecutionPolicy Bypass -File scripts/run_wb_tests.ps1
```

### Тестові сценарії
- **API доступність** - перевірка роботи всіх ендпоінтів
- **Валідація даних** - тестування коректності вхідних параметрів
- **Кешування** - перевірка роботи механізмів кешування
- **Fallback** - тестування роботи при недоступності зовнішніх API
- **Обробка помилок** - перевірка коректної обробки помилок

## Додаткова інформація

- **[VERSION.md](VERSION.md)** - детальна інформація про версії та залежності
- **[План проекту](plan/project%20plan.md)** - технічний план розробки
- **[API документація](http://localhost:8000/docs)** - інтерактивна документація (після запуску сервера)
