<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ï–∫–æ–Ω–æ–º–µ—Ç—Ä–∏—á–Ω–∏–π –î–∞—à–±–æ—Ä–¥ - –¢–æ—Ä–≥—ñ–≤–µ–ª—å–Ω–æ-–≤–∏—Ä–æ–±–Ω–∏—á–µ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: #2c3e50 !important;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
        }
        
        .kpi-card.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .kpi-card.warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .kpi-card.info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .kpi-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .kpi-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .filter-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .btn-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 10px 25px;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–∞ –ø–∞–Ω–µ–ª—å -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-chart-line me-2"></i>
                –ï–∫–æ–Ω–æ–º–µ—Ç—Ä–∏—á–Ω–∏–π –î–∞—à–±–æ—Ä–¥
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link me-3" href="/docs-page">
                    <i class="fas fa-book me-1"></i>
                    –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
                </a>
                <a class="nav-link me-3" href="/docs" target="_blank">
                    <i class="fas fa-code me-1"></i>
                    API Docs
                </a>
                <button class="btn btn-custom" onclick="regenerateData()">
                    <i class="fas fa-sync-alt me-2"></i>
                    –û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ
                </button>
            </div>
        </div>
    </nav>

    <!-- –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å—É –¥–∞–Ω–∏—Ö -->
    <div class="container mt-3">
        <div class="alert alert-info d-flex align-items-center" id="data-status-alert" style="display: none !important;">
            <i class="fas fa-info-circle me-2"></i>
            <div>
                <strong>–°—Ç–∞—Ç—É—Å –¥–∞–Ω–∏—Ö:</strong> <span id="data-status-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
                <small class="d-block text-muted" id="data-status-details"></small>
            </div>
        </div>
    </div>

 
    <div class="container mt-4">
        <!-- KPI –ü–∞–Ω–µ–ª—å -->
        <div class="row" id="kpi-panel">
            <div class="col-md-3">
                <div class="kpi-card success">
                    <div class="kpi-value" id="total-revenue">‚Ç¥0</div>
                    <div class="kpi-label">
                        <i class="fas fa-money-bill-wave me-2"></i>
                        –ó–∞–≥–∞–ª—å–Ω–∞ –≤–∏—Ä—É—á–∫–∞
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card warning">
                    <div class="kpi-value" id="total-profit">‚Ç¥0</div>
                    <div class="kpi-label">
                        <i class="fas fa-chart-pie me-2"></i>
                        –ó–∞–≥–∞–ª—å–Ω–∏–π –ø—Ä–∏–±—É—Ç–æ–∫
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card info">
                    <div class="kpi-value" id="total-sales">0</div>
                    <div class="kpi-label">
                        <i class="fas fa-shopping-cart me-2"></i>
                        –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–¥–∞–∂—ñ–≤
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-value" id="profit-margin">0%</div>
                    <div class="kpi-label">
                        <i class="fas fa-percentage me-2"></i>
                        –°–µ—Ä–µ–¥–Ω—è –º–∞—Ä–∂–∞
                    </div>
                </div>
            </div>
        </div>

        <!-- –§—ñ–ª—å—Ç—Ä–∏ -->
        <div class="filter-section">
            <h5 class="mb-3">
                <i class="fas fa-filter me-2"></i>
                –§—ñ–ª—å—Ç—Ä–∏ –¥–∞–Ω–∏—Ö
            </h5>
            <div class="row">
                <div class="col-md-3">
                    <label class="form-label">–ü–æ—á–∞—Ç–∫–æ–≤–∞ –¥–∞—Ç–∞</label>
                    <input type="date" class="form-control" id="start-date">
                </div>
                <div class="col-md-3">
                    <label class="form-label">–ö—ñ–Ω—Ü–µ–≤–∞ –¥–∞—Ç–∞</label>
                    <input type="date" class="form-control" id="end-date">
                </div>
                <div class="col-md-3">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                    <select class="form-select" id="category-filter">
                        <option value="">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">–†–µ–≥—ñ–æ–Ω</label>
                    <select class="form-select" id="region-filter">
                        <option value="">–í—Å—ñ —Ä–µ–≥—ñ–æ–Ω–∏</option>
                    </select>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-12">
                    <button class="btn btn-custom" onclick="applyFilters()">
                        <i class="fas fa-search me-2"></i>
                        –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏
                    </button>
                    <button class="btn btn-outline-secondary ms-2" onclick="clearFilters()">
                        <i class="fas fa-times me-2"></i>
                        –û—á–∏—Å—Ç–∏—Ç–∏
                    </button>
                </div>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –ø–µ—Ä–µ–≥–ª—è–¥—É —Ñ–∞–π–ª—ñ–≤ -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-database me-2"></i>
                        –ü–µ—Ä–µ–≥–ª—è–¥ —Ñ–∞–π–ª—ñ–≤ –¥–∞–Ω–∏—Ö
                        <button class="btn btn-sm btn-outline-success ms-2" onclick="loadFilesList()" title="–û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª—ñ–≤">
                            <i class="fas fa-sync-alt"></i> –û–Ω–æ–≤–∏—Ç–∏
                        </button>
                    </div>
                    <div id="files-panel">
                        <div class="row">
                            <div class="col-md-4">
                                <h6>–§–∞–π–ª–∏ –¥–∞–Ω–∏—Ö</h6>
                                <div id="files-list" class="list-group">
                                    <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª—ñ–≤ –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π —Ç—É—Ç -->
                                </div>
                            </div>
                            <div class="col-md-8">
                                <h6>–í–º—ñ—Å—Ç —Ñ–∞–π–ª—É</h6>
                                <div id="file-content">
                                    <p class="text-muted">–û–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É</p>
                                </div>
                                <div id="file-pagination" class="mt-3">
                                    <!-- –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è –±—É–¥–µ —Ç—É—Ç -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- –ì—Ä–∞—Ñ—ñ–∫–∏ -->
        <div class="row">
            <!-- –ì—Ä–∞—Ñ—ñ–∫ –ø—Ä–æ–¥–∞–∂—ñ–≤ —É —á–∞—Å—ñ -->
            <div class="col-md-6">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-chart-line me-2"></i>
                        –î–∏–Ω–∞–º—ñ–∫–∞ –ø—Ä–æ–¥–∞–∂—ñ–≤
                    </div>
                    <div id="sales-chart" style="height: 400px;"></div>
                </div>
            </div>
            
            <!-- –ì—Ä–∞—Ñ—ñ–∫ –ø—Ä–æ–¥–∞–∂—ñ–≤ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ -->
            <div class="col-md-6">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-chart-bar me-2"></i>
                        –¢–æ–ø –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
                    </div>
                    <div id="products-chart" style="height: 400px;"></div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- –ì—Ä–∞—Ñ—ñ–∫ –ø—Ä–æ–¥–∞–∂—ñ–≤ –∑–∞ —Ä–µ–≥—ñ–æ–Ω–∞–º–∏ -->
            <div class="col-md-6">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-chart-pie me-2"></i>
                        –†–æ–∑–ø–æ–¥—ñ–ª –∑–∞ —Ä–µ–≥—ñ–æ–Ω–∞–º–∏
                    </div>
                    <div id="regions-chart" style="height: 400px;"></div>
                </div>
            </div>
            
            <!-- –ì—Ä–∞—Ñ—ñ–∫ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ -->
            <div class="col-md-6">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-chart-area me-2"></i>
                        –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
                    </div>
                    <div id="profitability-chart" style="height: 400px;"></div>
                </div>
            </div>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª—å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç (–ø–µ—Ä–µ–º—ñ—â–µ–Ω–æ –≤ –∫—ñ–Ω–µ—Ü—å —Ç–∞ —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ —à–∏—Ä–∏–Ω—É) -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fab fa-bitcoin me-2"></i>
                        –û–≥–ª—è–¥ —Ä–∏–Ω–∫—É –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
                        <button class="btn btn-sm btn-outline-success ms-2" onclick="loadCryptoMarketData()" title="–û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ" id="crypto-refresh-btn">
                            <i class="fas fa-sync-alt"></i> –û–Ω–æ–≤–∏—Ç–∏
                        </button>
                        <button class="btn btn-sm btn-outline-warning ms-2" onclick="clearSavedCryptoData()" title="–û—á–∏—Å—Ç–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ" id="crypto-clear-btn">
                            <i class="fas fa-trash-alt"></i> –û—á–∏—Å—Ç–∏—Ç–∏
                        </button>
                        <span id="crypto-status" class="ms-3 text-muted small"></span>
                        <div class="ms-3 d-inline-block">
                            <select id="crypto-currency" class="form-select form-select-sm" style="width: auto; display: inline-block;">
                                <option value="usd" selected>USD</option>
                                <option value="uah">UAH</option>
                                <option value="eur">EUR</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex align-items-center gap-4 mb-2">
                        <div class="small text-muted">
                            <i class="fas fa-globe me-1"></i>
                            –ó–∞–≥–∞–ª—å–Ω–∞ –∫–∞–ø—ñ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–∏–Ω–∫—É: <strong id="crypto-global-mcap">‚Äî</strong>
                        </div>
                        <div class="small text-muted">
                            <i class="fab fa-btc me-1"></i>
                            –î–æ–º—ñ–Ω–∞—Ü—ñ—è BTC: <strong id="crypto-global-btc">‚Äî</strong>
                        </div>
                        <div class="small text-muted">
                            <span id="crypto-global-status"></span>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>#</th>
                                    <th>–ù–∞–∑–≤–∞</th>
                                    <th>–¶—ñ–Ω–∞</th>
                                    <th>24–≥ (%)</th>
                                    <th>–†–∏–Ω–∫–æ–≤–∞ –∫–∞–ø—ñ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è</th>
                                    <th>–û–±'—î–º (24–≥)</th>
                                </tr>
                            </thead>
                            <tbody id="crypto-market-table"></tbody>
                        </table>
                    </div>
                    <div class="mt-2 small text-muted">
                        –î–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö: <a href="https://www.coingecko.com/en/api/documentation" target="_blank" rel="noopener noreferrer">CoinGecko API</a>. –î–∞–Ω—ñ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∑ –ø—É–±–ª—ñ—á–Ω–æ–≥–æ API –±–µ–∑ –∫–ª—é—á–∞.
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –¥–∞–Ω–∏—Ö –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É (–ø–µ—Ä–µ–º—ñ—â–µ–Ω–æ –≤ –∫—ñ–Ω–µ—Ü—å —Å—Ç–æ—Ä—ñ–Ω–∫–∏) -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-globe me-2"></i>
                        –ï–∫–æ–Ω–æ–º–µ—Ç—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É
                        <button class="btn btn-sm btn-outline-success ms-2" onclick="loadWorldBankData()" title="–û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ" id="worldbank-refresh-btn">
                            <i class="fas fa-sync-alt"></i> –û–Ω–æ–≤–∏—Ç–∏
                        </button>
                        <button class="btn btn-sm btn-outline-warning ms-2" onclick="clearAllWorldBankData()" title="–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ" id="worldbank-clear-btn">
                            <i class="fas fa-trash-alt"></i> –û—á–∏—Å—Ç–∏—Ç–∏
                        </button>
                        <span id="worldbank-status" class="ms-3 text-muted small"></span>
                    </div>
                    <div id="worldbank-panel">
                        <!-- –ó–∞–≥–∞–ª—å–Ω–∏–π —Å—Ç–∞—Ç—É—Å API –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É -->
                        <div class="alert alert-info d-flex align-items-center mb-3" id="worldbank-api-status-alert" aria-live="polite" aria-atomic="true">
                            <i class="fas fa-info-circle me-2"></i>
                            <div>
                                <strong>API –°—Ç–∞—Ç—É—Å:</strong> <span id="worldbank-api-status-text">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞...</span>
                                <small class="d-block text-muted" id="worldbank-api-status-details">–¢–µ—Å—Ç—É—î–º–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É</small>
                            </div>
                        </div>
                        

                        <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –ø–æ —Ä–æ–∑–¥—ñ–ª–∞—Ö -->
                        <ul class="nav nav-tabs" id="worldbank-tabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="indicators-tab" data-bs-toggle="tab" data-bs-target="#indicators-content" type="button" role="tab">
                                    <i class="fas fa-chart-line me-1"></i>
                                    –ü–æ–∫–∞–∑–Ω–∏–∫–∏
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="normalized-tab" data-bs-toggle="tab" data-bs-target="#normalized-content" type="button" role="tab">
                                    <i class="fas fa-calculator me-1"></i>
                                    –ù–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="health-tab" data-bs-toggle="tab" data-bs-target="#health-content" type="button" role="tab">
                                    <i class="fas fa-heartbeat me-1"></i>
                                    –ï–∫–æ–Ω–æ–º—ñ—á–Ω–µ –∑–¥–æ—Ä–æ–≤'—è
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="comparison-tab" data-bs-toggle="tab" data-bs-target="#comparison-content" type="button" role="tab">
                                    <i class="fas fa-balance-scale me-1"></i>
                                    –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="trends-tab" data-bs-toggle="tab" data-bs-target="#trends-content" type="button" role="tab">
                                    <i class="fas fa-trending-up me-1"></i>
                                    –¢—Ä–µ–Ω–¥–∏
                                </button>
                            </li>
                        </ul>

                        <!-- –í–º—ñ—Å—Ç –≤–∫–ª–∞–¥–æ–∫ -->
                        <div class="tab-content" id="worldbank-tab-content">
                            <!-- –í–∫–ª–∞–¥–∫–∞ –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤ -->
                            <div class="tab-pane fade show active" id="indicators-content" role="tabpanel">
                                    <!-- –°—Ç–∞—Ç—É—Å –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –ü–æ–∫–∞–∑–Ω–∏–∫–∏ -->
                                    <div class="alert alert-light d-flex align-items-center mb-3" id="indicators-status-alert" style="display: none;">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <div>
                                            <strong>–ü—ñ–¥–∫–∞–∑–∫–∞:</strong> <span id="indicators-status-text">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏"</span>
                                            <small class="d-block text-muted" id="indicators-status-details">–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏, –ø–æ–∫–∞–∑–Ω–∏–∫–∏ —Ç–∞ –ø–µ—Ä—ñ–æ–¥</small>
                                        </div>
                                    </div>
                                    
                                    <!-- –§—ñ–ª—å—Ç—Ä–∏ –¥–ª—è –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É -->
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <label class="form-label">–ö—Ä–∞—ó–Ω–∏</label>
                                            <select id="worldbank-countries" class="form-select" multiple>
                                                <!-- –ë—É–¥–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">–ü–æ–∫–∞–∑–Ω–∏–∫–∏</label>
                                            <select id="worldbank-indicators" class="form-select" multiple>
                                                <!-- –ë—É–¥–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–∫</label>
                                            <input type="number" id="worldbank-start-year" class="form-control" value="2020" min="1960" max="2024">
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">–ö—ñ–Ω—Ü–µ–≤–∏–π —Ä—ñ–∫</label>
                                            <input type="number" id="worldbank-end-year" class="form-control" value="2023" min="1960" max="2024">
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">&nbsp;</label>
                                            <div>
                                                <button class="btn btn-custom w-100" onclick="loadWorldBankData()">
                                                    <i class="fas fa-download me-1"></i>
                                                    –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                <div class="row mt-3">
                                    <div class="col-md-12">
                                        <div id="worldbank-indicators-chart" style="height: 500px;"></div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-12">
                                        <div class="mb-2 text-muted small">
                                            –í–∞–ª—é—Ç–∞ –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤: <span class="badge bg-secondary">USD</span> <span class="ms-1">(–∑–∞ –¥–∞–Ω–∏–º–∏ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É)</span>
                                        </div>
                                        <div class="table-responsive">
                                            <table id="worldbank-indicators-table" class="table table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>–ö—Ä–∞—ó–Ω–∞</th>
                                                        <th>–†—ñ–∫</th>
                                                        <th>–í–í–ü (USD)</th>
                                                        <th>–í–í–ü –Ω–∞ –¥—É—à—É (USD)</th>
                                                        <th>–Ü–Ω—Ñ–ª—è—Ü—ñ—è</th>
                                                        <th>–ë–µ–∑—Ä–æ–±—ñ—Ç—Ç—è</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- –î–∞–Ω—ñ –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ç—É—Ç -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –í–∫–ª–∞–¥–∫–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è -->
                            <div class="tab-pane fade" id="comparison-content" role="tabpanel">
                                    <!-- –°—Ç–∞—Ç—É—Å –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è -->
                                    <div class="alert alert-light d-flex align-items-center mb-3" id="comparison-status-alert" style="display: none;">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <div>
                                            <strong>–ü—ñ–¥–∫–∞–∑–∫–∞:</strong> <span id="comparison-status-text">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–æ—Ä—ñ–≤–Ω—è—Ç–∏"</span>
                                            <small class="d-block text-muted" id="comparison-status-details">–û–±–µ—Ä—ñ—Ç—å –ø–æ–∫–∞–∑–Ω–∏–∫, –∫—Ä–∞—ó–Ω–∏ —Ç–∞ —Ä–æ–∫—ñ–≤ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É</small>
                                        </div>
                                    </div>
                                    
                                <div class="row mt-3">
                                    <div class="col-md-8">
                                        <div id="worldbank-comparison-chart" style="height: 400px;"></div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label class="form-label">–ü–æ–∫–∞–∑–Ω–∏–∫</label>
                                                    <select id="comparison-indicator" class="form-select">
                                                        <option value="GDP_PER_CAPITA">–í–í–ü –Ω–∞ –¥—É—à—É –Ω–∞—Å–µ–ª–µ–Ω–Ω—è</option>
                                                        <option value="GDP">–í–í–ü</option>
                                                        <option value="INFLATION">–Ü–Ω—Ñ–ª—è—Ü—ñ—è</option>
                                                        <option value="UNEMPLOYMENT">–ë–µ–∑—Ä–æ–±—ñ—Ç—Ç—è</option>
                                                        <option value="LIFE_EXPECTANCY">–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∂–∏—Ç—Ç—è</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">–ö—Ä–∞—ó–Ω–∏ –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è</label>
                                                    <input type="text" id="comparison-countries" class="form-control" placeholder="UA,US,DE,PL" value="UA,US,DE,PL">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">–†–æ–∫—ñ–≤ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É</label>
                                                    <input type="number" id="comparison-years" class="form-control" value="10" min="5" max="30">
                                                </div>
                                                <button class="btn btn-custom w-100" onclick="loadComparisonData()">
                                                    <i class="fas fa-chart-bar me-1"></i>
                                                    –ü–æ—Ä—ñ–≤–Ω—è—Ç–∏
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –í–∫–ª–∞–¥–∫–∞ —Ç—Ä–µ–Ω–¥—ñ–≤ -->
                            <div class="tab-pane fade" id="trends-content" role="tabpanel">
                                    <!-- –°—Ç–∞—Ç—É—Å –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –¢—Ä–µ–Ω–¥–∏ -->
                                    <div class="alert alert-light d-flex align-items-center mb-3" id="trends-status-alert" style="display: none;">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <div>
                                            <strong>–ü—ñ–¥–∫–∞–∑–∫–∞:</strong> <span id="trends-status-text">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏"</span>
                                            <small class="d-block text-muted" id="trends-status-details">–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω—É, –ø–æ–∫–∞–∑–Ω–∏–∫–∏ —Ç–∞ —Ä–æ–∫—ñ–≤ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É</small>
                                        </div>
                                    </div>
                                    
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0">–ê–Ω–∞–ª—ñ–∑ —Ç—Ä–µ–Ω–¥—ñ–≤</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label class="form-label">–ö—Ä–∞—ó–Ω–∞</label>
                                                    <select id="trends-country" class="form-select">
                                                        <option value="UA">–£–∫—Ä–∞—ó–Ω–∞</option>
                                                        <option value="US">–°–®–ê</option>
                                                        <option value="DE">–ù—ñ–º–µ—á—á–∏–Ω–∞</option>
                                                        <option value="PL">–ü–æ–ª—å—â–∞</option>
                                                        <option value="CN">–ö–∏—Ç–∞–π</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">–ü–æ–∫–∞–∑–Ω–∏–∫–∏</label>
                                                    <select id="trends-indicators" class="form-select" multiple>
                                                        <option value="GDP">–í–í–ü</option>
                                                        <option value="GDP_PER_CAPITA">–í–í–ü –Ω–∞ –¥—É—à—É</option>
                                                        <option value="INFLATION">–Ü–Ω—Ñ–ª—è—Ü—ñ—è</option>
                                                        <option value="UNEMPLOYMENT">–ë–µ–∑—Ä–æ–±—ñ—Ç—Ç—è</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">–†–æ–∫—ñ–≤ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É</label>
                                                    <input type="number" id="trends-years" class="form-control" value="20" min="5" max="50">
                                                </div>
                                                <button class="btn btn-custom w-100" onclick="loadTrendsData()">
                                                    <i class="fas fa-trending-up me-1"></i>
                                                    –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div id="worldbank-trends-chart" style="height: 500px;"></div>
                                        <div id="trends-analysis" class="mt-3">
                                            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑—É –±—É–¥—É—Ç—å —Ç—É—Ç -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –í–∫–ª–∞–¥–∫–∞ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö -->
                            <div class="tab-pane fade" id="normalized-content" role="tabpanel">
                                    <!-- –°—Ç–∞—Ç—É—Å –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –ù–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ -->
                                    <div class="alert alert-light d-flex align-items-center mb-3" id="normalized-status-alert" style="display: none;">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <div>
                                            <strong>–ü—ñ–¥–∫–∞–∑–∫–∞:</strong> <span id="normalized-status-text">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ù–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ"</span>
                                            <small class="d-block text-muted" id="normalized-status-details">–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏, –ø–æ–∫–∞–∑–Ω–∏–∫–∏, –≤–∞–ª—é—Ç—É —Ç–∞ –ø–µ—Ä—ñ–æ–¥</small>
                                        </div>
                                    </div>
                                    
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-calculator me-2"></i>
                                                    –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
                                                </h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label class="form-label">–ö—Ä–∞—ó–Ω–∏</label>
                                                    <select id="normalized-countries" class="form-select" multiple>
                                                        <option value="UA">–£–∫—Ä–∞—ó–Ω–∞</option>
                                                        <option value="US">–°–®–ê</option>
                                                        <option value="DE">–ù—ñ–º–µ—á—á–∏–Ω–∞</option>
                                                        <option value="PL">–ü–æ–ª—å—â–∞</option>
                                                        <option value="FR">–§—Ä–∞–Ω—Ü—ñ—è</option>
                                                        <option value="GB">–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω—ñ—è</option>
                                                        <option value="CN">–ö–∏—Ç–∞–π</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">–ü–æ–∫–∞–∑–Ω–∏–∫–∏</label>
                                                    <select id="normalized-indicators" class="form-select" multiple>
                                                        <option value="GDP">–í–í–ü</option>
                                                        <option value="GDP_PER_CAPITA">–í–í–ü –Ω–∞ –¥—É—à—É</option>
                                                        <option value="INFLATION">–Ü–Ω—Ñ–ª—è—Ü—ñ—è</option>
                                                        <option value="UNEMPLOYMENT">–ë–µ–∑—Ä–æ–±—ñ—Ç—Ç—è</option>
                                                        <option value="EXPORTS">–ï–∫—Å–ø–æ—Ä—Ç</option>
                                                        <option value="IMPORTS">–Ü–º–ø–æ—Ä—Ç</option>
                                                        <option value="POPULATION">–ù–∞—Å–µ–ª–µ–Ω–Ω—è</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">–í–∞–ª—é—Ç–∞</label>
                                                    <select id="normalized-currency" class="form-select">
                                                        <option value="USD">–î–æ–ª–∞—Ä –°–®–ê</option>
                                                        <option value="EUR">–Ñ–≤—Ä–æ</option>
                                                        <option value="UAH">–ì—Ä–∏–≤–Ω—è</option>
                                                        <option value="PLN">–ó–ª–æ—Ç–∏–π</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–∫</label>
                                                    <input type="number" id="normalized-start-year" class="form-control" value="2020" min="2000" max="2023">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">–ö—ñ–Ω—Ü–µ–≤–∏–π —Ä—ñ–∫</label>
                                                    <input type="number" id="normalized-end-year" class="form-control" value="2023" min="2000" max="2023">
                                                </div>
                                                <button class="btn btn-custom w-100" onclick="loadNormalizedData()">
                                                    <i class="fas fa-calculator me-1"></i>
                                                    –ù–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div id="normalized-chart" style="height: 500px;"></div>
                                        <div id="normalized-table" class="mt-3">
                                            <!-- –¢–∞–±–ª–∏—Ü—è –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –í–∫–ª–∞–¥–∫–∞ –∞–Ω–∞–ª—ñ–∑—É –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è -->
                            <div class="tab-pane fade" id="health-content" role="tabpanel">
                                    <!-- –°—Ç–∞—Ç—É—Å –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –ï–∫–æ–Ω–æ–º—ñ—á–Ω–µ –∑–¥–æ—Ä–æ–≤'—è -->
                                    <div class="alert alert-light d-flex align-items-center mb-3" id="health-status-alert" style="display: none;">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <div>
                                            <strong>–ü—ñ–¥–∫–∞–∑–∫–∞:</strong> <span id="health-status-text">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è"</span>
                                            <small class="d-block text-muted" id="health-status-details">–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏ —Ç–∞ –ø–µ—Ä—ñ–æ–¥ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è</small>
                                        </div>
                                    </div>
                                    
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-heartbeat me-2"></i>
                                                    –ê–Ω–∞–ª—ñ–∑ –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è
                                                </h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label class="form-label">–ö—Ä–∞—ó–Ω–∏ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É</label>
                                                    <select id="health-countries" class="form-select" multiple>
                                                        <option value="UA">–£–∫—Ä–∞—ó–Ω–∞</option>
                                                        <option value="US">–°–®–ê</option>
                                                        <option value="DE">–ù—ñ–º–µ—á—á–∏–Ω–∞</option>
                                                        <option value="PL">–ü–æ–ª—å—â–∞</option>
                                                        <option value="FR">–§—Ä–∞–Ω—Ü—ñ—è</option>
                                                        <option value="GB">–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω—ñ—è</option>
                                                        <option value="CN">–ö–∏—Ç–∞–π</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–∫</label>
                                                    <input type="number" id="health-start-year" class="form-control" value="2020" min="2000" max="2023">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">–ö—ñ–Ω—Ü–µ–≤–∏–π —Ä—ñ–∫</label>
                                                    <input type="number" id="health-end-year" class="form-control" value="2023" min="2000" max="2023">
                                                </div>
                                                <button class="btn btn-custom w-100" onclick="loadEconomicHealth()">
                                                    <i class="fas fa-heartbeat me-1"></i>
                                                    –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è
                                                </button>
                                                <div class="mt-3">
                                                    <small class="text-muted">
                                                        <strong>–ú–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—è:</strong><br>
                                                        ‚Ä¢ –í–í–ü –Ω–∞ –¥—É—à—É: 30%<br>
                                                        ‚Ä¢ –Ü–Ω—Ñ–ª—è—Ü—ñ—è: 25%<br>
                                                        ‚Ä¢ –ë–µ–∑—Ä–æ–±—ñ—Ç—Ç—è: 25%<br>
                                                        ‚Ä¢ –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∂–∏—Ç—Ç—è: 20%
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div id="health-chart" style="height: 500px;"></div>
                                        <div id="health-analysis" class="mt-3">
                                            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑—É –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
        let currentData = {
            sales: [],
            trends: [],
            profit: [],
            stats: {}
        };

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
            loadInitialData();
            setupDateFilters();
            initializeWorldBankData(); // –î–æ–¥–∞—î–º–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–∞–Ω–∏—Ö –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –ø—ñ–¥–∫–∞–∑–∫–∏ –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫
            showTabHints();
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞–Ω API –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
            checkAPIStatus();
            
            // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ñ–∞–π–ª–∏ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ
            console.log('–ó–∞–ø—É—Å–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤...');
            window.loadFilesList = loadFilesList;
            window.loadFileContent = loadFileContent;
            window.showFileStats = showFileStats;
            window.applyFilters = applyFilters;
            window.clearFilters = clearFilters;
            window.regenerateData = regenerateData;
            
            window.loadWorldBankData = loadWorldBankData;
            window.loadComparisonData = loadComparisonData;
            window.loadTrendsData = loadTrendsData;
            window.loadNormalizedData = loadNormalizedData;
            window.loadEconomicHealth = loadEconomicHealth;
            window.loadCryptoMarketData = loadCryptoMarketData;

            loadFilesList();

            // –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∫—Ä–∏–ø—Ç–æ –¥–∞–Ω—ñ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
            const savedCryptoData = loadCryptoDataFromStorage();
            if (savedCryptoData) {
                console.log('üìÇ –ü–æ–∫–∞–∑–∞–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∫—Ä–∏–ø—Ç–æ –¥–∞–Ω—ñ');
                displaySavedCryptoData(savedCryptoData);
            } else {
                console.log('üîÑ –ó–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö –Ω–µ–º–∞—î, –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –Ω–æ–≤—ñ');
                loadCryptoMarketData();
            }

            // –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ World Bank –¥–∞–Ω—ñ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
            const worldBankKeys = Object.keys(localStorage).filter(key => key.startsWith('worldBank_'));
            if (worldBankKeys.length > 0) {
                console.log(`üìÇ –ó–Ω–∞–π–¥–µ–Ω–æ ${worldBankKeys.length} –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö World Bank –¥–∞–Ω–∏—Ö`);
                updateWorldBankStatus(`–ó–Ω–∞–π–¥–µ–Ω–æ ${worldBankKeys.length} –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö`, 'info');
            } else {
                console.log('üîÑ –ó–±–µ—Ä–µ–∂–µ–Ω–∏—Ö World Bank –¥–∞–Ω–∏—Ö –Ω–µ–º–∞—î');
            }

            // –ê–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–∏–Ω–∫—É –ø—Ä–∏ –∑–º—ñ–Ω—ñ –≤–∞–ª—é—Ç–∏
            const cryptoCur = document.getElementById('crypto-currency');
            if (cryptoCur) {
                cryptoCur.addEventListener('change', () => {
                    loadCryptoMarketData();
                });
            }
        });
        function updateCryptoStatus(message, type = 'info') {
            const statusEl = document.getElementById('crypto-status');
            if (statusEl) {
                const icon = type === 'loading' ? 'fas fa-spinner fa-spin' : 
                           type === 'success' ? 'fas fa-check-circle text-success' :
                           type === 'error' ? 'fas fa-exclamation-triangle text-danger' :
                           'fas fa-info-circle text-info';
                statusEl.innerHTML = `<i class="${icon}"></i> ${message}`;
            }
        }

        function saveCryptoDataToStorage(data, globalData, lastUpdate = null) {
            try {
                const cryptoData = {
                    marketData: data,
                    globalData: globalData,
                    lastUpdate: lastUpdate
                };
                localStorage.setItem('cryptoData', JSON.stringify(cryptoData));
                console.log('üíæ –ö—Ä–∏–ø—Ç–æ –¥–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ');
            } catch (error) {
                console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:', error);
            }
        }

        function loadCryptoDataFromStorage() {
            try {
                const savedData = localStorage.getItem('cryptoData');
                if (savedData) {
                    const cryptoData = JSON.parse(savedData);
                    console.log('üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∫—Ä–∏–ø—Ç–æ –¥–∞–Ω—ñ –≤—ñ–¥:', cryptoData.savedAt);
                    return cryptoData;
                }
            } catch (error) {
                console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö:', error);
            }
            return null;
        }

        function displaySavedCryptoData(cryptoData) {
            const { marketData, globalData, lastUpdate } = cryptoData;
            
            // –ü–æ–∫–∞–∑–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ —Ä–∏–Ω–∫—É
            const tableBody = document.getElementById('crypto-market-table');
            tableBody.innerHTML = '';
            marketData.forEach(coin => {
                const change24h = coin.price_change_percentage_24h;
                const colorClass = (typeof change24h === 'number' && !isNaN(change24h) && change24h >= 0) ? 'text-success' : 'text-danger';
                const symbol = (coin.symbol || '').toUpperCase();
                const currencyCode = 'USD'; // –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ –∑–∞–≤–∂–¥–∏ –≤ USD
                const row = `
                    <tr style="cursor:pointer" onclick="openCryptoCoin('${coin.id}', '${coin.name}', '${symbol}', 'usd')">
                        <td>${coin.market_cap_rank ?? ''}</td>
                        <td>
                            <img src="${coin.image}" width="20" height="20" class="me-2">
                            <strong>${coin.name}</strong>
                            <span class="text-muted">${symbol}</span>
                        </td>
                        <td>${formatCurrencyByCode(coin.current_price, currencyCode)}</td>
                        <td class="${colorClass}">${(typeof change24h === 'number' && !isNaN(change24h)) ? change24h.toFixed(2) + '%' : 'N/A'}</td>
                        <td>${formatCurrencyByCode(coin.market_cap || 0, currencyCode)}</td>
                        <td>${formatCurrencyByCode(coin.total_volume || 0, currencyCode)}</td>
                    </tr>
                `;
                tableBody.insertAdjacentHTML('beforeend', row);
            });

            // –ü–æ–∫–∞–∑–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –≥–ª–æ–±–∞–ª—å–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏
            if (globalData && globalData.data) {
                const mcapUsd = globalData.data.total_market_cap && globalData.data.total_market_cap.usd ? globalData.data.total_market_cap.usd : null;
                const btcDom = globalData.data.market_cap_percentage && globalData.data.market_cap_percentage.btc ? globalData.data.market_cap_percentage.btc : null;
                
                if (mcapUsd != null) {
                    document.getElementById('crypto-global-mcap').textContent = formatCurrencyByCode(mcapUsd, 'USD');
                }
                if (btcDom != null) {
                    document.getElementById('crypto-global-btc').textContent = btcDom.toFixed(2) + '%';
                }
            }

            // –ü–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∑ —á–∞—Å–æ–º –æ—Ç—Ä–∏–º–∞–Ω–Ω—è
            const statusMessage = lastUpdate ? 
                `–ü–æ–∫–∞–∑–∞–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ (–æ—Ç—Ä–∏–º–∞–Ω–æ: ${lastUpdate})` : 
                `–ü–æ–∫–∞–∑–∞–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ`;
            updateCryptoStatus(statusMessage, 'info');
            
            const globalStatusEl = document.getElementById('crypto-global-status');
            if (globalStatusEl) {
                const globalStatusMessage = lastUpdate ? 
                    `<i class="fas fa-save text-info"></i> –î–∞–Ω—ñ –æ—Ç—Ä–∏–º–∞–Ω–æ: ${lastUpdate}` : 
                    `<i class="fas fa-save text-info"></i> –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ`;
                globalStatusEl.innerHTML = globalStatusMessage;
            }
        }

        function clearSavedCryptoData() {
            try {
                localStorage.removeItem('cryptoData');
                console.log('üóëÔ∏è –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –∫—Ä–∏–ø—Ç–æ –¥–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ');
                
                // –û—á–∏—Å—Ç–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é —Ç–∞ –º–µ—Ç—Ä–∏–∫–∏
                const tableBody = document.getElementById('crypto-market-table');
                if (tableBody) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-muted">
                                <i class="fas fa-info-circle me-2"></i>
                                –î–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–û–Ω–æ–≤–∏—Ç–∏" –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.
                            </td>
                        </tr>
                    `;
                }
                
                // –û—á–∏—Å—Ç–∏—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏
                document.getElementById('crypto-global-mcap').textContent = '‚Äî';
                document.getElementById('crypto-global-btc').textContent = '‚Äî';
                
                // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å–∏
                updateCryptoStatus('–ó–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ', 'info');
                const globalStatusEl = document.getElementById('crypto-global-status');
                if (globalStatusEl) {
                    globalStatusEl.innerHTML = '<i class="fas fa-trash text-warning"></i> –î–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ';
                }
                
                // –û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å–∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
                setTimeout(() => {
                    updateCryptoStatus('', 'info');
                    if (globalStatusEl) {
                        globalStatusEl.innerHTML = '';
                    }
                }, 3000);
                
            } catch (error) {
                console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:', error);
                updateCryptoStatus('–ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö', 'error');
            }
        }

        // World Bank data caching functions
        function saveWorldBankDataToStorage(dataType, data) {
            try {
                const worldBankData = {
                    [dataType]: data,
                    timestamp: new Date().toISOString(),
                    savedAt: new Date().toLocaleString('uk-UA')
                };
                localStorage.setItem(`worldBank_${dataType}`, JSON.stringify(worldBankData));
                console.log(`üíæ World Bank ${dataType} –¥–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ`);
            } catch (error) {
                console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è World Bank –¥–∞–Ω–∏—Ö:', error);
            }
        }

        function loadWorldBankDataFromStorage(dataType) {
            try {
                const savedData = localStorage.getItem(`worldBank_${dataType}`);
                if (savedData) {
                    const worldBankData = JSON.parse(savedData);
                    console.log(`üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ World Bank ${dataType} –¥–∞–Ω—ñ –≤—ñ–¥:`, worldBankData.savedAt);
                    return worldBankData;
                }
            } catch (error) {
                console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö World Bank –¥–∞–Ω–∏—Ö:', error);
            }
            return null;
        }

        function clearSavedWorldBankData(dataType) {
            try {
                localStorage.removeItem(`worldBank_${dataType}`);
                console.log(`üóëÔ∏è –ó–±–µ—Ä–µ–∂–µ–Ω—ñ World Bank ${dataType} –¥–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ`);
            } catch (error) {
                console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è World Bank –¥–∞–Ω–∏—Ö:', error);
            }
        }

        function updateWorldBankStatus(message, type = 'info', elementId = 'worldbank-status') {
            const statusEl = document.getElementById(elementId);
            if (statusEl) {
                const icon = type === 'loading' ? 'fas fa-spinner fa-spin' : 
                           type === 'success' ? 'fas fa-check-circle text-success' :
                           type === 'error' ? 'fas fa-exclamation-triangle text-danger' :
                           'fas fa-info-circle text-info';
                statusEl.innerHTML = `<i class="${icon}"></i> ${message}`;
            }
        }

        function clearAllWorldBankData() {
            try {
                // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ World Bank –¥–∞–Ω—ñ
                const keys = Object.keys(localStorage);
                let clearedCount = 0;
                
                keys.forEach(key => {
                    if (key.startsWith('worldBank_')) {
                        localStorage.removeItem(key);
                        clearedCount++;
                    }
                });
                
                console.log(`üóëÔ∏è –û—á–∏—â–µ–Ω–æ ${clearedCount} –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö World Bank –¥–∞–Ω–∏—Ö`);
                
                // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                const chartContainer = document.getElementById('worldbank-indicators-chart');
                if (chartContainer) {
                    chartContainer.innerHTML = '<p class="text-muted">–î–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–û–Ω–æ–≤–∏—Ç–∏" –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.</p>';
                }
                
                const tableContainer = document.getElementById('worldbank-indicators-table');
                if (tableContainer) {
                    tableContainer.innerHTML = '<p class="text-muted">–î–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–û–Ω–æ–≤–∏—Ç–∏" –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.</p>';
                }
                
                // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
                updateWorldBankStatus(`–û—á–∏—â–µ–Ω–æ ${clearedCount} –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö`, 'info');
                
                // –û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
                setTimeout(() => {
                    updateWorldBankStatus('', 'info');
                }, 3000);
                
            } catch (error) {
                console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è World Bank –¥–∞–Ω–∏—Ö:', error);
                updateWorldBankStatus('–ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö', 'error');
            }
        }

        async function loadCryptoMarketData() {
            try {
                const curSel = document.getElementById('crypto-currency');
                const cur = curSel ? curSel.value : 'usd';
                const apiUrl = `/api/crypto/markets?currency=${encodeURIComponent(cur)}&per_page=100`;
                
                // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –Ω–∞ –ø–∞–Ω–µ–ª—ñ
                updateCryptoStatus('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...', 'loading');
                
                console.log('üîÑ –ó–∞–ø–∏—Ç –¥–æ –∫—Ä–∏–ø—Ç–æ API:', apiUrl);
                console.log('üì° –ü–æ–≤–Ω–∏–π URL:', window.location.origin + apiUrl);
                
                const resp = await fetch(apiUrl);
                
                console.log('üìä –°—Ç–∞—Ç—É—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:', resp.status, resp.statusText);
                
                if (!resp.ok) {
                    throw new Error(`HTTP error! status: ${resp.status}`);
                }
                
                const response = await resp.json();
                
                // Handle new response format with metadata / –û–±—Ä–æ–±–∫–∞ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏
                let data, lastUpdate, currency, totalCoins;
                if (response.data && Array.isArray(response.data)) {
                    // New format with metadata / –ù–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç –∑ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏
                    data = response.data;
                    lastUpdate = response.last_update;
                    currency = response.currency;
                    totalCoins = response.total_coins;
                } else if (Array.isArray(response)) {
                    // Old format (backward compatibility) / –°—Ç–∞—Ä–∏–π —Ñ–æ—Ä–º–∞—Ç (–∑–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å)
                    data = response;
                    lastUpdate = null;
                    currency = cur;
                    totalCoins = data.length;
                } else {
                    throw new Error('Invalid response format');
                }
                
                console.log('üìà –û—Ç—Ä–∏–º–∞–Ω–æ –¥–∞–Ω–∏—Ö:', totalCoins, '–º–æ–Ω–µ—Ç');
                console.log('üìã –í–∞–ª—é—Ç–∞:', currency);
                console.log('üïí –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:', lastUpdate || '–Ω–µ –≤—ñ–¥–æ–º–æ');
                if (data.length > 0) {
                    console.log('ü™ô –ü–µ—Ä—à–∞ –º–æ–Ω–µ—Ç–∞:', data[0].name, '(' + data[0].symbol + ')');
                }
                
                // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å —É—Å–ø—ñ—Ö—É –∑ —á–∞—Å–æ–º –æ—Ç—Ä–∏–º–∞–Ω–Ω—è
                const statusMessage = lastUpdate ? 
                    `–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${data.length} –º–æ–Ω–µ—Ç (–æ—Ç—Ä–∏–º–∞–Ω–æ: ${lastUpdate})` : 
                    `–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${data.length} –º–æ–Ω–µ—Ç`;
                updateCryptoStatus(statusMessage, 'success');
                
                // –û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
                setTimeout(() => {
                    updateCryptoStatus('', 'info');
                }, 3000);
                
                const tableBody = document.getElementById('crypto-market-table');
                tableBody.innerHTML = '';
                data.forEach(coin => {
                    const change24h = coin.price_change_percentage_24h;
                    const colorClass = (typeof change24h === 'number' && !isNaN(change24h) && change24h >= 0) ? 'text-success' : 'text-danger';
                    const symbol = (coin.symbol || '').toUpperCase();
                    const currencyCode = (cur || 'usd').toUpperCase();
                    const row = `
                        <tr style="cursor:pointer" onclick="openCryptoCoin('${coin.id}', '${coin.name}', '${symbol}', '${cur}')">
                            <td>${coin.market_cap_rank ?? ''}</td>
                            <td>
                                <img src="${coin.image}" width="20" height="20" class="me-2">
                                <strong>${coin.name}</strong>
                                <span class="text-muted">${symbol}</span>
                            </td>
                            <td>${formatCurrencyByCode(coin.current_price, currencyCode)}</td>
                            <td class="${colorClass}">${(typeof change24h === 'number' && !isNaN(change24h)) ? change24h.toFixed(2) + '%' : 'N/A'}</td>
                            <td>${formatCurrencyByCode(coin.market_cap || 0, currencyCode)}</td>
                            <td>${formatCurrencyByCode(coin.total_volume || 0, currencyCode)}</td>
                        </tr>
                    `;
                    tableBody.insertAdjacentHTML('beforeend', row);
                });
                
                // –û–Ω–æ–≤–∏—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏ (–≤ USD)
                const globalData = await loadCryptoGlobal();
                
                // –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ –ª–æ–∫–∞–ª—å–Ω–æ –∑ —á–∞—Å–æ–º –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
                saveCryptoDataToStorage(data, globalData, lastUpdate);
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫—Ä–∏–ø—Ç–æ-–¥–∞–Ω–∏—Ö:', error);
                
                // –í–∏–∑–Ω–∞—á–∏—Ç–∏ —Ç–∏–ø –ø–æ–º–∏–ª–∫–∏ —Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                let errorMessage = error.message;
                let userMessage = '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ —Ä–∏–Ω–∫—É –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç';
                
                if (error.message.includes('Rate limit exceeded')) {
                    userMessage = '–ü–µ—Ä–µ–≤–∏—â–µ–Ω–æ –ª—ñ–º—ñ—Ç –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ CoinGecko API. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.';
                } else if (error.message.includes('timeout') || error.message.includes('not responding')) {
                    userMessage = 'CoinGecko API –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É.';
                } else if (error.message.includes('Failed to fetch')) {
                    userMessage = '–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É.';
                }
                
                // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –ø–æ–º–∏–ª–∫–∏ –Ω–∞ –ø–∞–Ω–µ–ª—ñ
                updateCryptoStatus(`–ü–æ–º–∏–ª–∫–∞: ${userMessage}`, 'error');
                
                const tableBody = document.getElementById('crypto-market-table');
                if (tableBody) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-danger">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                ${userMessage}
                                <br><small class="text-muted">–°–ø—Ä–æ–±—É–π—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∞–±–æ –ø–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –ø—ñ–∑–Ω—ñ—à–µ</small>
                            </td>
                        </tr>
                    `;
                }
                showError(userMessage);
            }
        }

        async function loadCryptoGlobal() {
            try {
                const apiUrl = '/api/crypto/global';
                
                // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö –º–µ—Ç—Ä–∏–∫
                const globalStatusEl = document.getElementById('crypto-global-status');
                if (globalStatusEl) {
                    globalStatusEl.innerHTML = '<i class="fas fa-spinner fa-spin text-info"></i> –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ—Ç—Ä–∏–∫...';
                }
                
                console.log('üåç –ó–∞–ø–∏—Ç –¥–æ –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö –º–µ—Ç—Ä–∏–∫:', apiUrl);
                console.log('üì° –ü–æ–≤–Ω–∏–π URL:', window.location.origin + apiUrl);
                
                const resp = await fetch(apiUrl);
                console.log('üìä –°—Ç–∞—Ç—É—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (–≥–ª–æ–±–∞–ª—å–Ω—ñ):', resp.status, resp.statusText);
                
                const response = await resp.json();
                console.log('üìã –¢–∏–ø –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö:', typeof response);
                
                // Handle new response format with metadata / –û–±—Ä–æ–±–∫–∞ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏
                let data, lastUpdate;
                if (response.data) {
                    // New format with metadata / –ù–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç –∑ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏
                    data = response.data;
                    lastUpdate = response.last_update;
                } else {
                    // Old format (backward compatibility) / –°—Ç–∞—Ä–∏–π —Ñ–æ—Ä–º–∞—Ç (–∑–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å)
                    data = response;
                    lastUpdate = null;
                }
                
                console.log('üìà –ì–ª–æ–±–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ –æ—Ç—Ä–∏–º–∞–Ω–æ:', data ? '—Ç–∞–∫' : '–Ω—ñ');
                console.log('üïí –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö:', lastUpdate || '–Ω–µ –≤—ñ–¥–æ–º–æ');
                
                const mcapUsd = data.total_market_cap && data.total_market_cap.usd ? data.total_market_cap.usd : null;
                const btcDom = data.market_cap_percentage && data.market_cap_percentage.btc ? data.market_cap_percentage.btc : null;
                
                if (mcapUsd != null) {
                    console.log('üí∞ –ó–∞–≥–∞–ª—å–Ω–∞ –∫–∞–ø—ñ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è:', formatCurrencyByCode(mcapUsd, 'USD'));
                    document.getElementById('crypto-global-mcap').textContent = formatCurrencyByCode(mcapUsd, 'USD');
                }
                if (btcDom != null) {
                    console.log('‚Çø –î–æ–º—ñ–Ω—É–≤–∞–Ω–Ω—è BTC:', btcDom.toFixed(2) + '%');
                    document.getElementById('crypto-global-btc').textContent = btcDom.toFixed(2) + '%';
                }
                
                // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å —É—Å–ø—ñ—Ö—É –∑ —á–∞—Å–æ–º –æ—Ç—Ä–∏–º–∞–Ω–Ω—è
                if (globalStatusEl) {
                    const statusMessage = lastUpdate ? 
                        `<i class="fas fa-check-circle text-success"></i> –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ç—Ä–∏–º–∞–Ω–æ: ${lastUpdate}` : 
                        '<i class="fas fa-check-circle text-success"></i> –ú–µ—Ç—Ä–∏–∫–∏ –æ–Ω–æ–≤–ª–µ–Ω–æ';
                    globalStatusEl.innerHTML = statusMessage;
                    
                    // –û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
                    setTimeout(() => {
                        globalStatusEl.innerHTML = '';
                    }, 3000);
                }
                
                return payload; // –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
            } catch (e) {
                console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö –º–µ—Ç—Ä–∏–∫:', e);
                
                // –í–∏–∑–Ω–∞—á–∏—Ç–∏ —Ç–∏–ø –ø–æ–º–∏–ª–∫–∏
                let userMessage = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ—Ç—Ä–∏–∫';
                if (e.message.includes('Rate limit exceeded')) {
                    userMessage = '–õ—ñ–º—ñ—Ç –∑–∞–ø–∏—Ç—ñ–≤ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–æ';
                } else if (e.message.includes('timeout') || e.message.includes('not responding')) {
                    userMessage = 'API –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î';
                } else if (e.message.includes('Failed to fetch')) {
                    userMessage = '–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ';
                }
                
                // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –ø–æ–º–∏–ª–∫–∏
                const globalStatusEl = document.getElementById('crypto-global-status');
                if (globalStatusEl) {
                    globalStatusEl.innerHTML = `<i class="fas fa-exclamation-triangle text-danger"></i> ${userMessage}`;
                }
                
                return null; // –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ null –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ
            }
        }

        async function openCryptoCoin(coinId, coinName, symbol, currencyCode) {
            try {
                const cur = (currencyCode || 'usd');
                const apiUrl = `/api/crypto/coins/${coinId}/history?currency=${encodeURIComponent(cur)}&days=30`;
                
                console.log('ü™ô –ó–∞–ø–∏—Ç –¥–æ —ñ—Å—Ç–æ—Ä—ñ—ó –º–æ–Ω–µ—Ç–∏:', apiUrl);
                console.log('üì° –ü–æ–≤–Ω–∏–π URL:', window.location.origin + apiUrl);
                console.log('üè∑Ô∏è –ú–æ–Ω–µ—Ç–∞:', coinName, '(' + symbol + ')');
                
                const resp = await fetch(apiUrl);
                console.log('üìä –°—Ç–∞—Ç—É—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (—ñ—Å—Ç–æ—Ä—ñ—è):', resp.status, resp.statusText);
                
                const data = await resp.json();
                console.log('üìã –¢–∏–ø —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö:', typeof data);
                if (data.prices && Array.isArray(data.prices)) {
                    console.log('üìà –¢–æ—á–æ–∫ —ñ—Å—Ç–æ—Ä—ñ—ó —Ü—ñ–Ω:', data.prices.length);
                }
                const prices = (data && data.prices) ? data.prices : [];
                const x = prices.map(p => new Date(p[0]));
                const y = prices.map(p => p[1]);
                const trace = { x, y, type: 'scatter', mode: 'lines', line: { color: '#4facfe' } };
                const layout = { title: `${coinName} (${symbol}) ‚Ä¢ –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤`, margin: { t: 40, r: 20, l: 50, b: 40 } };
                // –°—Ç–≤–æ—Ä—é—î–º–æ –º–æ–¥–∞–ª, —è–∫—â–æ –π–æ–≥–æ –Ω–µ–º–∞—î
                let modalEl = document.getElementById('cryptoCoinModal');
                if (!modalEl) {
                    document.body.insertAdjacentHTML('beforeend', `
                        <div class="modal fade" id="cryptoCoinModal" tabindex="-1" aria-hidden="true">
                          <div class="modal-dialog modal-lg modal-dialog-centered">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="crypto-coin-title">–î–µ—Ç–∞–ª—ñ –º–æ–Ω–µ—Ç–∏</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                <div id="crypto-coin-chart" style="height:400px;"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                    `);
                    modalEl = document.getElementById('cryptoCoinModal');
                }
                document.getElementById('crypto-coin-title').textContent = `${coinName} (${symbol})`;
                Plotly.newPlot('crypto-coin-chart', [trace], layout, { responsive: true });
                const bsModal = new bootstrap.Modal(modalEl);
                bsModal.show();
            } catch (e) {
                showError('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é —Ü—ñ–Ω–∏ –º–æ–Ω–µ—Ç–∏.');
            }
        }

        // –û–∫—Ä–µ–º–∞ —Ñ—É–Ω–∫—Ü—ñ—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –≤–∞–ª—é—Ç –∑ –∫–æ–¥–æ–º (–Ω–µ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É—î –∑ –≥–ª–æ–±–∞–ª—å–Ω–æ—é UAH)
        function formatCurrencyByCode(amount, currencyCode) {
            try {
                return new Intl.NumberFormat('uk-UA', {
                    style: 'currency',
                    currency: currencyCode || 'USD',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(amount ?? 0);
            } catch (e) {
                return String(amount ?? 0);
            }
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
        async function loadInitialData() {
            try {
                showLoading();
                
                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≤—Å—ñ –¥–∞–Ω—ñ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ
                const [salesRes, trendsRes, profitRes, statsRes, categoriesRes, regionsRes] = await Promise.all([
                    fetch('/api/sales?limit=5000'),
                    fetch('/api/trends'),
                    fetch('/api/profit'),
                    fetch('/api/stats'),
                    fetch('/api/categories'),
                    fetch('/api/regions')
                ]);

                currentData.sales = await salesRes.json();
                currentData.trends = await trendsRes.json();
                currentData.profit = await profitRes.json();
                currentData.stats = await statsRes.json();

                // –ó–∞–ø–æ–≤–Ω—é—î–º–æ —Ñ—ñ–ª—å—Ç—Ä–∏
                const categories = await categoriesRes.json();
                const regions = await regionsRes.json();
                
                populateSelect('category-filter', categories.categories);
                populateSelect('region-filter', regions.regions);

                // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateKPIPanel();
                updateCharts();
                
                // –ù–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
                
                hideLoading();
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö: ' + error.message);
            }
        }

        // –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è select –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
        function populateSelect(selectId, data) {
            const select = document.getElementById(selectId);
            if (data && Array.isArray(data)) {
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item;
                    option.textContent = item.charAt(0).toUpperCase() + item.slice(1);
                    select.appendChild(option);
                });
            }
        }

        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –¥–∞—Ç
        function setupDateFilters() {
            const today = new Date();
            const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
            
            document.getElementById('end-date').value = today.toISOString().split('T')[0];
            document.getElementById('start-date').value = lastMonth.toISOString().split('T')[0];
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è KPI –ø–∞–Ω–µ–ª—ñ
        function updateKPIPanel() {
            const stats = currentData.stats;
            
            document.getElementById('total-revenue').textContent = formatCurrency(stats.total_revenue);
            document.getElementById('total-profit').textContent = formatCurrency(stats.total_profit);
            document.getElementById('total-sales').textContent = formatNumber(stats.total_sales);
            document.getElementById('profit-margin').textContent = formatPercentage(stats.avg_profit_margin);
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
        function updateCharts() {
            updateSalesChart();
            updateProductsChart();
            updateRegionsChart();
            updateProfitabilityChart();
        }

        // –ì—Ä–∞—Ñ—ñ–∫ –ø—Ä–æ–¥–∞–∂—ñ–≤ —É —á–∞—Å—ñ
        function updateSalesChart() {
            const trends = currentData.trends;
            
            if (!trends || trends.length === 0) {
                document.getElementById('sales-chart').innerHTML = '<p>–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</p>';
                return;
            }
            
            const trace = {
                x: trends.map(t => t.date),
                y: trends.map(t => t.total_revenue),
                type: 'scatter',
                mode: 'lines+markers',
                name: '–í–∏—Ä—É—á–∫–∞',
                line: { color: '#667eea', width: 3 },
                marker: { size: 6 }
            };

            const layout = {
                title: '',
                xaxis: { title: '–î–∞—Ç–∞' },
                yaxis: { title: '–í–∏—Ä—É—á–∫–∞ (‚Ç¥)' },
                hovermode: 'closest',
                showlegend: false,
                margin: { t: 0, b: 50, l: 50, r: 20 }
            };

            Plotly.newPlot('sales-chart', [trace], layout, {responsive: true});
        }

        // –ì—Ä–∞—Ñ—ñ–∫ —Ç–æ–ø –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
        function updateProductsChart() {
            const sales = currentData.sales;
            
            if (!sales || sales.length === 0) {
                document.getElementById('products-chart').innerHTML = '<p>–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</p>';
                return;
            }
            
            // –ì—Ä—É–ø—É—î–º–æ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
            const productRevenue = {};
            sales.forEach(sale => {
                productRevenue[sale.product_name] = (productRevenue[sale.product_name] || 0) + sale.total_revenue;
            });

            // –°–æ—Ä—Ç—É—î–º–æ —Ç–∞ –±–µ—Ä–µ–º–æ —Ç–æ–ø-10
            const topProducts = Object.entries(productRevenue)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);

            const trace = {
                x: topProducts.map(([name]) => name.length > 20 ? name.substring(0, 20) + '...' : name),
                y: topProducts.map(([,revenue]) => revenue),
                type: 'bar',
                marker: { color: '#38ef7d' }
            };

            const layout = {
                title: '',
                xaxis: { title: '–ü—Ä–æ–¥—É–∫—Ç' },
                yaxis: { title: '–í–∏—Ä—É—á–∫–∞ (‚Ç¥)' },
                margin: { t: 0, b: 100, l: 50, r: 20 }
            };

            Plotly.newPlot('products-chart', [trace], layout, {responsive: true});
        }

        // –ì—Ä–∞—Ñ—ñ–∫ –ø—Ä–æ–¥–∞–∂—ñ–≤ –∑–∞ —Ä–µ–≥—ñ–æ–Ω–∞–º–∏
        function updateRegionsChart() {
            const sales = currentData.sales;
            
            // –ì—Ä—É–ø—É—î–º–æ –∑–∞ —Ä–µ–≥—ñ–æ–Ω–∞–º–∏
            const regionRevenue = {};
            sales.forEach(sale => {
                regionRevenue[sale.region] = (regionRevenue[sale.region] || 0) + sale.total_revenue;
            });

            const trace = {
                labels: Object.keys(regionRevenue).map(r => r.charAt(0).toUpperCase() + r.slice(1)),
                values: Object.values(regionRevenue),
                type: 'pie',
                marker: {
                    colors: ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe']
                }
            };

            const layout = {
                title: '',
                margin: { t: 0, b: 50, l: 50, r: 50 }
            };

            Plotly.newPlot('regions-chart', [trace], layout, {responsive: true});
        }

        // –ì—Ä–∞—Ñ—ñ–∫ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ
        function updateProfitabilityChart() {
            const profit = currentData.profit;
            
            // –°–æ—Ä—Ç—É—î–º–æ –∑–∞ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—é
            const sortedProfit = profit.sort((a, b) => b.profit_percentage - a.profit_percentage).slice(0, 10);

            const trace = {
                x: sortedProfit.map(p => p.product_name.length > 15 ? p.product_name.substring(0, 15) + '...' : p.product_name),
                y: sortedProfit.map(p => p.profit_percentage),
                type: 'bar',
                marker: { color: '#f5576c' }
            };

            const layout = {
                title: '',
                xaxis: { title: '–ü—Ä–æ–¥—É–∫—Ç' },
                yaxis: { title: '–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å (%)' },
                margin: { t: 0, b: 100, l: 50, r: 20 }
            };

            Plotly.newPlot('profitability-chart', [trace], layout, {responsive: true});
        }

        // –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
        async function applyFilters() {
            try {
                showLoading();
                
                const params = new URLSearchParams();
                
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;
                const category = document.getElementById('category-filter').value;
                const region = document.getElementById('region-filter').value;
                
                if (startDate) params.append('start_date', startDate);
                if (endDate) params.append('end_date', endDate);
                if (category) params.append('category', category);
                if (region) params.append('region', region);
                
                params.append('limit', '5000');
                
                const response = await fetch(`/api/sales?${params}`);
                currentData.sales = await response.json();
                
                // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const statsResponse = await fetch('/api/stats');
                currentData.stats = await statsResponse.json();
                
                updateKPIPanel();
                updateCharts();
                
                hideLoading();
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤: ' + error.message);
            }
        }

        // –û—á–∏—â–µ–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
        function clearFilters() {
            document.getElementById('start-date').value = '';
            document.getElementById('end-date').value = '';
            document.getElementById('category-filter').value = '';
            document.getElementById('region-filter').value = '';
            
            loadInitialData();
        }

        // –†–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
        async function regenerateData() {
            try {
                showLoading();
                
                const response = await fetch('/api/regenerate', { method: 'POST' });
                const result = await response.json();
                
                if (response.ok) {
                    await loadInitialData();
                    showSuccess('–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ!');
                } else {
                    throw new Error(result.detail || '–ü–æ–º–∏–ª–∫–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö');
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö: ' + error.message);
            }
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
        function formatCurrency(amount) {
            return new Intl.NumberFormat('uk-UA', {
                style: 'currency',
                currency: 'UAH',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function formatNumber(number) {
            return new Intl.NumberFormat('uk-UA').format(number);
        }

        function formatPercentage(percentage) {
            return percentage.toFixed(1) + '%';
        }

        function showLoading() {
            document.body.style.opacity = '0.7';
            document.body.style.pointerEvents = 'none';
        }

        function hideLoading() {
            document.body.style.opacity = '1';
            document.body.style.pointerEvents = 'auto';
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.container').firstChild);
            
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'alert alert-success';
            successDiv.textContent = message;
            document.querySelector('.container').insertBefore(successDiv, document.querySelector('.container').firstChild);
            
            setTimeout(() => successDiv.remove(), 3000);
        }

        


        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞–∑–≤–∏ –ø–æ–∫–∞–∑–Ω–∏–∫–∞
        function getIndicatorName(indicator) {
            const names = {
                'GDP': '–í–í–ü',
                'GDP_PER_CAPITA': '–í–í–ü –Ω–∞ –¥—É—à—É',
                'INFLATION': '–Ü–Ω—Ñ–ª—è—Ü—ñ—è',
                'UNEMPLOYMENT': '–ë–µ–∑—Ä–æ–±—ñ—Ç—Ç—è',
                'EXPORTS': '–ï–∫—Å–ø–æ—Ä—Ç',
                'IMPORTS': '–Ü–º–ø–æ—Ä—Ç',
                'POPULATION': '–ù–∞—Å–µ–ª–µ–Ω–Ω—è',
                'LIFE_EXPECTANCY': '–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∂–∏—Ç—Ç—è',
                'INTERNET_USERS': '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É',
                'EDUCATION_EXPENDITURE': '–í–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –æ—Å–≤—ñ—Ç—É'
            };
            return names[indicator] || indicator;
        }

        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ñ–∞–π–ª–∞–º–∏
        let currentFile = null;
        let currentOffset = 0;
        const pageSize = 50;

        async function loadFilesList() {
            try {
                console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É —Ñ–∞–π–ª—ñ–≤...');
                const response = await fetch('/api/files');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('–û—Ç—Ä–∏–º–∞–Ω—ñ —Ñ–∞–π–ª–∏:', result);
                
                const filesList = document.getElementById('files-list');
                if (!filesList) {
                    console.error('–ï–ª–µ–º–µ–Ω—Ç files-list –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!');
                    return;
                }
                
                filesList.innerHTML = '';
                
                if (result.files && Array.isArray(result.files)) {
                    console.log('–û–±—Ä–æ–±–∫–∞ —Ñ–∞–π–ª—ñ–≤:', result.files.length);
                    result.files.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'list-group-item list-group-item-action';
                    fileItem.style.cursor = 'pointer';
                    fileItem.innerHTML = `
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">${file.name}</h6>
                            <div>
                                <button class="btn btn-sm btn-outline-info me-2" onclick="event.stopPropagation(); showFileStats('${file.name}')" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
                                    <i class="fas fa-chart-bar"></i>
                                </button>
                                <small>${formatFileSize(file.size)}</small>
                            </div>
                        </div>
                        <p class="mb-1">–ú–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ: ${new Date(file.modified).toLocaleString('uk-UA')}</p>
                    `;
                    
                    fileItem.addEventListener('click', () => loadFileContent(file.name));
                    filesList.appendChild(fileItem);
                });
                } else {
                    console.log('–ù–µ–º–∞—î —Ñ–∞–π–ª—ñ–≤ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è');
                    filesList.innerHTML = '<div class="list-group-item text-muted">–§–∞–π–ª–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ</div>';
                }
                console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É —Ñ–∞–π–ª—ñ–≤:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É —Ñ–∞–π–ª—ñ–≤: ' + error.message);
                document.getElementById('files-list').innerHTML = '<div class="list-group-item text-danger">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤</div>';
            }
        }

        async function loadFileContent(filename, offset = 0) {
            try {
                currentFile = filename;
                currentOffset = offset;
                
                const response = await fetch(`/api/files/${filename}?limit=${pageSize}&offset=${offset}`);
                const result = await response.json();
                
                displayFileContent(result);
                updatePagination(result);
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–º—ñ—Å—Ç—É —Ñ–∞–π–ª—É:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–º—ñ—Å—Ç—É —Ñ–∞–π–ª—É: ' + error.message);
            }
        }

        function displayFileContent(fileData) {
            const contentDiv = document.getElementById('file-content');
            
            if (!fileData.data || fileData.data.length === 0) {
                contentDiv.innerHTML = '<p class="text-muted">–§–∞–π–ª –ø–æ—Ä–æ–∂–Ω—ñ–π</p>';
                return;
            }
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é
            let tableHtml = `
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                ${fileData.columns.map(col => `<th>${col}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            fileData.data.forEach(row => {
                tableHtml += '<tr>';
                fileData.columns.forEach(col => {
                    const value = row[col];
                    const displayValue = value === null || value === undefined ? '-' : value;
                    tableHtml += `<td>${displayValue}</td>`;
                });
                tableHtml += '</tr>';
            });
            
            tableHtml += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-2">
                    <small class="text-muted">
                        –ü–æ–∫–∞–∑–∞–Ω–æ ${fileData.offset + 1}-${fileData.offset + fileData.data.length} –∑ ${fileData.total_rows} –∑–∞–ø–∏—Å—ñ–≤
                    </small>
                </div>
            `;
            
            contentDiv.innerHTML = tableHtml;
        }

        function updatePagination(fileData) {
            const paginationDiv = document.getElementById('file-pagination');
            const totalPages = Math.ceil(fileData.total_rows / pageSize);
            const currentPage = Math.floor(fileData.offset / pageSize) + 1;
            
            if (totalPages <= 1) {
                paginationDiv.innerHTML = '';
                return;
            }
            
            let paginationHtml = '<nav><ul class="pagination pagination-sm">';
            
            // –ö–Ω–æ–ø–∫–∞ "–ü–æ–ø–µ—Ä–µ–¥–Ω—è"
            if (currentPage > 1) {
                paginationHtml += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="loadFileContent('${currentFile}', ${(currentPage - 2) * pageSize})">–ü–æ–ø–µ—Ä–µ–¥–Ω—è</a>
                    </li>
                `;
            }
            
            // –ù–æ–º–µ—Ä–∏ —Å—Ç–æ—Ä—ñ–Ω–æ–∫
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentPage ? 'active' : '';
                paginationHtml += `
                    <li class="page-item ${isActive}">
                        <a class="page-link" href="#" onclick="loadFileContent('${currentFile}', ${(i - 1) * pageSize})">${i}</a>
                    </li>
                `;
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–ù–∞—Å—Ç—É–ø–Ω–∞"
            if (currentPage < totalPages) {
                paginationHtml += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="loadFileContent('${currentFile}', ${currentPage * pageSize})">–ù–∞—Å—Ç—É–ø–Ω–∞</a>
                    </li>
                `;
            }
            
            paginationHtml += '</ul></nav>';
            paginationDiv.innerHTML = paginationHtml;
        }

        async function showFileStats(filename) {
            try {
                const response = await fetch(`/api/files/${filename}/stats`);
                const stats = await response.json();
                
                let statsHtml = `
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª—É: ${stats.filename}</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>–†—è–¥–∫—ñ–≤:</strong> ${stats.total_rows.toLocaleString()}</p>
                                    <p><strong>–ö–æ–ª–æ–Ω–æ–∫:</strong> ${stats.total_columns}</p>
                                    <p><strong>–†–æ–∑–º—ñ—Ä –≤ –ø–∞–º'—è—Ç—ñ:</strong> ${formatFileSize(stats.memory_usage)}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>–ö–æ–ª–æ–Ω–∫–∏:</strong></p>
                                    <ul class="list-unstyled">
                                        ${stats.columns.map(col => `<li><code>${col}</code> (${stats.data_types[col]})</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                `;
                
                if (stats.numeric_stats) {
                    statsHtml += `
                        <div class="mt-3">
                            <h6>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∏—Å–ª–æ–≤–∏—Ö –∫–æ–ª–æ–Ω–æ–∫:</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>–ö–æ–ª–æ–Ω–∫–∞</th>
                                            <th>–ú—ñ–Ω</th>
                                            <th>–ú–∞–∫—Å</th>
                                            <th>–°–µ—Ä–µ–¥–Ω—î</th>
                                            <th>–ú–µ–¥—ñ–∞–Ω–∞</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                    `;
                    
                    Object.keys(stats.numeric_stats).forEach(col => {
                        const colStats = stats.numeric_stats[col];
                        statsHtml += `
                            <tr>
                                <td><code>${col}</code></td>
                <td>${typeof colStats.min === 'number' ? colStats.min.toFixed(2) : (colStats.min ? parseFloat(colStats.min).toFixed(2) : '-')}</td>
                <td>${typeof colStats.max === 'number' ? colStats.max.toFixed(2) : (colStats.max ? parseFloat(colStats.max).toFixed(2) : '-')}</td>
                <td>${typeof colStats.mean === 'number' ? colStats.mean.toFixed(2) : (colStats.mean ? parseFloat(colStats.mean).toFixed(2) : '-')}</td>
                <td>${typeof colStats['50%'] === 'number' ? colStats['50%'].toFixed(2) : (colStats['50%'] ? parseFloat(colStats['50%']).toFixed(2) : '-')}</td>
                            </tr>
                        `;
                    });
                    
                    statsHtml += '</tbody></table></div>';
                }
                
                statsHtml += '</div></div>';
                
                // –ü–æ–∫–∞–∑—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ
                const modalHtml = `
                    <div class="modal fade" id="statsModal" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª—É</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    ${statsHtml}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // –í–∏–¥–∞–ª—è—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –º–æ–¥–∞–ª—å, —è–∫—â–æ —ñ—Å–Ω—É—î
                const existingModal = document.getElementById('statsModal');
                if (existingModal) {
                    existingModal.remove();
                }
                
                // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –º–æ–¥–∞–ª—å
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                
                // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª—å
                const modal = new bootstrap.Modal(document.getElementById('statsModal'));
                modal.show();
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–∞–π–ª—É:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–∞–π–ª—É: ' + error.message);
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –¥–∞–Ω–∏–º–∏ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É
        let worldBankData = null;
        let availableCountries = {};
        let availableIndicators = {};

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É
        async function initializeWorldBankData() {
            try {
                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å–ø–∏—Å–∫–∏ –∫—Ä–∞—ó–Ω —Ç–∞ –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤
                const [countriesResponse, indicatorsResponse] = await Promise.all([
                    fetch('/api/worldbank/countries'),
                    fetch('/api/worldbank/indicators-list')
                ]);

                const countriesData = await countriesResponse.json();
                const indicatorsData = await indicatorsResponse.json();

                availableCountries = countriesData.countries;
                availableIndicators = indicatorsData.indicators;

                // –ó–∞–ø–æ–≤–Ω—é—î–º–æ —Å–µ–ª–µ–∫—Ç–∏
                populateWorldBankSelects();

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—ñ–≤ –∫—Ä–∞—ó–Ω —Ç–∞ –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤');
            }
        }

        function populateWorldBankSelects() {
            // –ó–∞–ø–æ–≤–Ω—é—î–º–æ —Å–µ–ª–µ–∫—Ç –∫—Ä–∞—ó–Ω
            const countriesSelect = document.getElementById('worldbank-countries');
            countriesSelect.innerHTML = '';
            
            Object.entries(availableCountries).forEach(([code, name]) => {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = `${name} (${code})`;
                countriesSelect.appendChild(option);
            });

            // –ó–∞–ø–æ–≤–Ω—é—î–º–æ —Å–µ–ª–µ–∫—Ç –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤
            const indicatorsSelect = document.getElementById('worldbank-indicators');
            indicatorsSelect.innerHTML = '';
            
            Object.entries(availableIndicators).forEach(([key, code]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key.replace(/_/g, ' ');
                indicatorsSelect.appendChild(option);
            });
        }

        async function loadWorldBankData() {
            try {
                const countries = Array.from(document.getElementById('worldbank-countries').selectedOptions)
                    .map(option => option.value);
                const indicators = Array.from(document.getElementById('worldbank-indicators').selectedOptions)
                    .map(option => option.value);
                const startYear = document.getElementById('worldbank-start-year').value;
                const endYear = document.getElementById('worldbank-end-year').value;

                // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–∏–±–æ—Ä—É
                if (countries.length === 0 && indicators.length === 0) {
                    showTabStatus('indicators', 'error', '–û–±–µ—Ä—ñ—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏', '–û–±–µ—Ä—ñ—Ç—å –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –æ–¥–Ω—É –∫—Ä–∞—ó–Ω—É —ñ –æ–¥–∏–Ω –ø–æ–∫–∞–∑–Ω–∏–∫');
                    showError('–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏ —Ç–∞ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è');
                    return;
                }
                if (countries.length === 0) {
                    showTabStatus('indicators', 'error', '–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏', '–û–±–µ—Ä—ñ—Ç—å –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –æ–¥–Ω—É –∫—Ä–∞—ó–Ω—É');
                    showError('–û–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–Ω—É –∫—Ä–∞—ó–Ω—É');
                    return;
                }
                if (indicators.length === 0) {
                    showTabStatus('indicators', 'error', '–û–±–µ—Ä—ñ—Ç—å –ø–æ–∫–∞–∑–Ω–∏–∫–∏', '–û–±–µ—Ä—ñ—Ç—å –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –æ–¥–∏–Ω –ø–æ–∫–∞–∑–Ω–∏–∫');
                    showError('–û–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω –ø–æ–∫–∞–∑–Ω–∏–∫');
                    return;
                }
                if (!startYear || !endYear || Number(startYear) > Number(endYear)) {
                    showTabStatus('indicators', 'error', '–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–µ—Ä—ñ–æ–¥', '–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–∫—ñ–≤');
                    showError('–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–µ—Ä—ñ–æ–¥: –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–æ–∫–∏ –ø–æ—á–∞—Ç–∫—É —Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è');
                    return;
                }

                // –ü–æ–∫–∞–∑—É—î–º–æ —Å—Ç–∞—Ç—É—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—ñ—Å–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
                showWorldBankStatus('info', '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', '–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç –¥–æ API');
                showTabStatus('indicators', 'info', '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', '–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç –¥–æ API');

                const params = new URLSearchParams();
                if (countries.length > 0) params.append('countries', countries.join(','));
                if (indicators.length > 0) params.append('indicators', indicators.join(','));
                params.append('start_year', startYear);
                params.append('end_year', endYear);

                const response = await fetch(`/api/worldbank/indicators?${params}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();

                worldBankData = result;
                updateWorldBankIndicatorsChart(result);
                updateWorldBankIndicatorsTable(result);
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–ª—é—á –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ
                const cacheKey = `indicators_${countries.join('_')}_${indicators.join('_')}_${startYear}_${endYear}`;
                saveWorldBankDataToStorage(cacheKey, result);
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å –¥–∞–Ω–∏—Ö (—ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —É –ø–∞–Ω–µ–ª—ñ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É)
                const rows = (result && result.data) ? result.data : result;
                const count = rows && rows.length ? rows.length : 0;
                if (rows && count > 0) {
                    const firstItem = rows[0];
                    if (firstItem.Country_Name === 'Ukraine' || firstItem.Country_Name === 'USA') {
                        showWorldBankStatus('warning', 
                            'API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π', 
                            '–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∑—Ä–∞–∑–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó');
                        showTabStatus('indicators', 'success', 
                            '–î–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 
                            `–û—Ç—Ä–∏–º–∞–Ω–æ –∑–∞–ø–∏—Å—ñ–≤: ${count}`);
                    } else {
                        showWorldBankStatus('success', 
                            'API –ø—Ä–∞—Ü—é—î', 
                            '–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –æ—Ç—Ä–∏–º–∞–Ω–æ –∑ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É');
                        showTabStatus('indicators', 'success', 
                            '–î–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 
                            `–û—Ç—Ä–∏–º–∞–Ω–æ –∑–∞–ø–∏—Å—ñ–≤: ${count}`);
                    }
                }

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É:', error);
                
                // –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ
                const countries = Array.from(document.getElementById('worldbank-countries').selectedOptions)
                    .map(option => option.value);
                const indicators = Array.from(document.getElementById('worldbank-indicators').selectedOptions)
                    .map(option => option.value);
                const startYear = document.getElementById('worldbank-start-year').value;
                const endYear = document.getElementById('worldbank-end-year').value;
                
                const cacheKey = `indicators_${countries.join('_')}_${indicators.join('_')}_${startYear}_${endYear}`;
                const savedData = loadWorldBankDataFromStorage(cacheKey);
                
                if (savedData && savedData[cacheKey]) {
                    console.log('üìÇ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ World Bank');
                    worldBankData = savedData[cacheKey];
                    updateWorldBankIndicatorsChart(savedData[cacheKey]);
                    updateWorldBankIndicatorsTable(savedData[cacheKey]);
                    
                    const rows = (savedData[cacheKey] && savedData[cacheKey].data) ? savedData[cacheKey].data : savedData[cacheKey];
                    const count = rows && rows.length ? rows.length : 0;
                    
                    showWorldBankStatus('warning', 
                        'API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π', 
                        `–ü–æ–∫–∞–∑–∞–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ –≤—ñ–¥ ${savedData.savedAt}`);
                    showTabStatus('indicators', 'success', 
                        '–ó–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ', 
                        `–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${count} –∑–∞–ø–∏—Å—ñ–≤ (–∑–±–µ—Ä–µ–∂–µ–Ω–æ ${savedData.savedAt})`);
                } else {
                    showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É: ' + error.message);
                    showWorldBankStatus('error', '–ü–æ–º–∏–ª–∫–∞ API', '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∑ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É');
                    showTabStatus('indicators', 'error', '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è', '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤');
                }
            }
        }

        function updateWorldBankIndicatorsChart(data) {
            if (!data.data || data.data.length === 0) {
                document.getElementById('worldbank-indicators-chart').innerHTML = '<p class="text-muted">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</p>';
                return;
            }

            // –ì—Ä—É–ø—É—î–º–æ –¥–∞–Ω—ñ –∑–∞ –∫—Ä–∞—ó–Ω–∞–º–∏ —Ç–∞ —Ä–æ–∫–∞–º–∏
            const chartData = {};
            data.data.forEach(row => {
                const country = row.Country_Name;
                const year = row.Year;
                
                if (!chartData[country]) {
                    chartData[country] = {};
                }
                chartData[country][year] = row;
            });

            // –°—Ç–≤–æ—Ä—é—î–º–æ –≥—Ä–∞—Ñ—ñ–∫ (–±—ñ–ª—å—à –Ω–∞–≥–ª—è–¥–Ω–∏–π –≤–∏–≥–ª—è–¥)
            const traces = [];
            Object.entries(chartData).forEach(([country, years]) => {
                const sortedYears = Object.keys(years).sort();
                const gdpData = sortedYears.map(year => years[year].GDP || 0);

                traces.push({
                    x: sortedYears,
                    y: gdpData,
                    name: country,
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { shape: 'spline', width: 3 },
                    marker: { size: 6 },
                    hovertemplate: `${country}<br>–†—ñ–∫: %{x}<br>–í–í–ü: %{y:,.2f} USD<extra></extra>`
                });
            });

            // –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –¥—ñ–∞–ø–∞–∑–æ–Ω –æ—Å—ñ Y
            let yMin = Infinity;
            let yMax = -Infinity;
            traces.forEach(trace => {
                (trace.y || []).forEach(val => {
                    if (val !== null && val !== undefined) {
                        if (val < yMin) yMin = val;
                        if (val > yMax) yMax = val;
                    }
                });
            });
            const yRange = (yMax - yMin) || 1;
            const yBuffer = yRange * 0.1;
            const finalYMin = yMin === Infinity ? 0 : yMin - yBuffer;
            const finalYMax = yMax === -Infinity ? 1 : yMax + yBuffer;

            const layout = {
                title: '–í–í–ü –∫—Ä–∞—ó–Ω —É —á–∞—Å—ñ',
                xaxis: { title: '–†—ñ–∫', rangeslider: { visible: true } },
                yaxis: { title: '–í–í–ü (USD)', tickformat: ',.2s', gridcolor: '#e9ecef', range: [finalYMin, finalYMax] },
                hovermode: 'x unified',
                legend: { orientation: 'h', y: -0.2 },
                margin: { t: 40, r: 20, l: 60, b: 60 }
            };

            Plotly.newPlot('worldbank-indicators-chart', traces, layout);
        }

        function updateWorldBankIndicatorsTable(data) {
            const tbody = document.querySelector('#worldbank-indicators-table tbody');
            tbody.innerHTML = '';

            if (!data.data || data.data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-muted">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</td></tr>';
                return;
            }

            data.data.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.Country_Name}</td>
                    <td>${row.Year}</td>
                    <td>${row.GDP ? row.GDP.toLocaleString() : '-'}</td>
                    <td>${row.GDP_PER_CAPITA ? row.GDP_PER_CAPITA.toLocaleString() : '-'}</td>
                    <td>${(typeof row.INFLATION === 'number' ? row.INFLATION.toFixed(2) : (row.INFLATION ? parseFloat(row.INFLATION).toFixed(2) : '-'))}${(row.INFLATION || row.INFLATION === 0) ? '%' : ''}</td>
                    <td>${(typeof row.UNEMPLOYMENT === 'number' ? row.UNEMPLOYMENT.toFixed(2) : (row.UNEMPLOYMENT ? parseFloat(row.UNEMPLOYMENT).toFixed(2) : '-'))}${(row.UNEMPLOYMENT || row.UNEMPLOYMENT === 0) ? '%' : ''}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function loadComparisonData() {
            try {
                const countries = document.getElementById('comparison-countries').value;
                const indicator = document.getElementById('comparison-indicator').value;
                const years = document.getElementById('comparison-years').value;

                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤–∏–±—Ä–∞–Ω—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏
                if (!countries) {
                    showTabStatus('comparison', 'error', '–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏', '–î–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–±—Ä–∞—Ç–∏ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –¥–≤—ñ –∫—Ä–∞—ó–Ω–∏');
                    return;
                }

                if (!indicator) {
                    showTabStatus('comparison', 'error', '–û–±–µ—Ä—ñ—Ç—å –ø–æ–∫–∞–∑–Ω–∏–∫', '–î–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–±—Ä–∞—Ç–∏ –ø–æ–∫–∞–∑–Ω–∏–∫');
                    return;
                }

                // –ü–æ–∫–∞–∑—É—î–º–æ —Å—Ç–∞—Ç—É—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                showWorldBankStatus('info', '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', '–û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∫—Ä–∞—ó–Ω...');
                showTabStatus('comparison', 'info', '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', '–û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∫—Ä–∞—ó–Ω...');

                const params = new URLSearchParams();
                params.append('countries', countries);
                params.append('indicator', indicator);
                params.append('years', years);

                const response = await fetch(`/api/worldbank/comparison?${params}`);
                const result = await response.json();

                updateComparisonChart(result);
                
                if (result.data && result.data.length > 0) {
                    showWorldBankStatus('success', 'API –ø—Ä–∞—Ü—é—î', '–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –æ—Ç—Ä–∏–º–∞–Ω–æ –∑ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É');
                    showTabStatus('comparison', 'success', '–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ', `–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ ${result.data.length} –∑–∞–ø–∏—Å—ñ–≤`);
                } else {
                    showWorldBankStatus('warning', 'API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π', '–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∑—Ä–∞–∑–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó');
                    showTabStatus('comparison', 'success', '–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ', `–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ ${result.data.length} –∑–∞–ø–∏—Å—ñ–≤`);
                }

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è: ' + error.message);
                showWorldBankStatus('error', '–ü–æ–º–∏–ª–∫–∞ API', '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∑ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É');
                showTabStatus('comparison', 'error', '–ü–æ–º–∏–ª–∫–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è', '–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∫—Ä–∞—ó–Ω');
            }
        }

        function updateComparisonChart(data) {
            if (!data.data || data.data.length === 0) {
                document.getElementById('worldbank-comparison-chart').innerHTML = '<p class="text-muted">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</p>';
                return;
            }

            // –ì—Ä—É–ø—É—î–º–æ –¥–∞–Ω—ñ –∑–∞ –∫—Ä–∞—ó–Ω–∞–º–∏
            const chartData = {};
            data.data.forEach(row => {
                const country = row.Country_Name;
                if (!chartData[country]) {
                    chartData[country] = [];
                }
                chartData[country].push({
                    year: row.Year,
                    value: row.Value
                });
            });

            // –°—Ç–≤–æ—Ä—é—î–º–æ –≥—Ä–∞—Ñ—ñ–∫
            const traces = [];
            Object.entries(chartData).forEach(([country, values]) => {
                const sortedValues = values.sort((a, b) => a.year - b.year);
                
                traces.push({
                    x: sortedValues.map(v => v.year),
                    y: sortedValues.map(v => v.value),
                    name: country,
                    type: 'scatter',
                    mode: 'lines+markers'
                });
            });

            const layout = {
                title: `–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∫—Ä–∞—ó–Ω: ${data.indicator}`,
                xaxis: { title: '–†—ñ–∫' },
                yaxis: { title: '–ó–Ω–∞—á–µ–Ω–Ω—è' },
                hovermode: 'closest'
            };

            Plotly.newPlot('worldbank-comparison-chart', traces, layout);
        }

        async function loadTrendsData() {
            try {
                const country = document.getElementById('trends-country').value;
                const indicators = Array.from(document.getElementById('trends-indicators').selectedOptions)
                    .map(option => option.value);
                const years = document.getElementById('trends-years').value;

                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤–∏–±—Ä–∞–Ω—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏
                if (!country) {
                    showTabStatus('trends', 'error', '–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω—É', '–î–ª—è –∞–Ω–∞–ª—ñ–∑—É —Ç—Ä–µ–Ω–¥—ñ–≤ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–±—Ä–∞—Ç–∏ –∫—Ä–∞—ó–Ω—É');
                    return;
                }

                if (indicators.length === 0) {
                    showTabStatus('trends', 'error', '–û–±–µ—Ä—ñ—Ç—å –ø–æ–∫–∞–∑–Ω–∏–∫–∏', '–î–ª—è –∞–Ω–∞–ª—ñ–∑—É —Ç—Ä–µ–Ω–¥—ñ–≤ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–±—Ä–∞—Ç–∏ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –æ–¥–∏–Ω –ø–æ–∫–∞–∑–Ω–∏–∫');
                    return;
                }

                // –ü–æ–∫–∞–∑—É—î–º–æ —Å—Ç–∞—Ç—É—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                showWorldBankStatus('info', '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', '–û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∑ API –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É...');
                showTabStatus('trends', 'info', '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', '–û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∑ API –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É...');

                const params = new URLSearchParams();
                if (indicators.length > 0) params.append('indicators', indicators.join(','));
                params.append('years', years);

                const response = await fetch(`/api/worldbank/trends/${country}?${params}`);
                const result = await response.json();

                updateTrendsChart(result);
                updateTrendsAnalysis(result);

                // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞—Ç—É—Å –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É
                if (result.trends && Object.keys(result.trends).length > 0) {
                    const count = Object.keys(result.trends).length;
                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ –∑—Ä–∞–∑–∫–æ–≤—ñ –¥–∞–Ω—ñ (–∑–∞–≤–∂–¥–∏ –£–∫—Ä–∞—ó–Ω–∞ –∑ –ø–µ–≤–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏)
                    const isSampleData = result.country === '–£–∫—Ä–∞—ó–Ω–∞' && 
                                        result.trends.GDP && 
                                        result.trends.GDP.latest_value === 200;
                    
                    if (isSampleData) {
                        showWorldBankStatus('warning', 
                            'API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π', 
                            '–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∑—Ä–∞–∑–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó');
                        showTabStatus('trends', 'success', 
                            '–ê–Ω–∞–ª—ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 
                            `–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤: ${count} –¥–ª—è ${result.country}`);
                    } else {
                        showWorldBankStatus('success', 
                            'API –ø—Ä–∞—Ü—é—î', 
                            '–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –æ—Ç—Ä–∏–º–∞–Ω–æ –∑ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É');
                        showTabStatus('trends', 'success', 
                            '–ê–Ω–∞–ª—ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 
                            `–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤: ${count} –¥–ª—è ${result.country}`);
                    }
                } else {
                    showWorldBankStatus('error', 
                        '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É', 
                        '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É —Ç—Ä–µ–Ω–¥—ñ–≤.');
                    showTabStatus('trends', 'error', 
                        '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö', 
                        '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É —Ç—Ä–µ–Ω–¥—ñ–≤.');
                }

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —Ç—Ä–µ–Ω–¥—ñ–≤:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —Ç—Ä–µ–Ω–¥—ñ–≤: ' + error.message);
                
                // –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É
                let errorDetails = error.message;
                if (error.message.includes('APIError')) {
                    errorDetails = 'API –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.';
                } else if (error.message.includes('JSON')) {
                    errorDetails = '–ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É JSON –≤—ñ–¥ API. –ú–æ–∂–ª–∏–≤–æ, —Å–µ—Ä–≤–µ—Ä —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π.';
                } else if (error.message.includes('timeout')) {
                    errorDetails = '–¢–∞–π–º-–∞—É—Ç –∑–∞–ø–∏—Ç—É –¥–æ API. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–º–µ–Ω—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–æ–∫—ñ–≤ –∞–Ω–∞–ª—ñ–∑—É.';
                }
                
                showWorldBankStatus('error', '–ü–æ–º–∏–ª–∫–∞ API', errorDetails);
                showTabStatus('trends', 'error', '–ü–æ–º–∏–ª–∫–∞ –∞–Ω–∞–ª—ñ–∑—É', '–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑ —Ç—Ä–µ–Ω–¥—ñ–≤');
            }
        }

        function updateTrendsChart(data) {
            if (!data.raw_data || data.raw_data.length === 0) {
                document.getElementById('worldbank-trends-chart').innerHTML = '<p class="text-muted">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</p>';
                return;
            }

            // –°—Ç–≤–æ—Ä—é—î–º–æ –≥—Ä–∞—Ñ—ñ–∫ –∑ –∫—ñ–ª—å–∫–æ–º–∞ –ø–æ–∫–∞–∑–Ω–∏–∫–∞–º–∏
            const traces = [];
            const indicators = Object.keys(data.trends || {});
            
            indicators.forEach(indicator => {
                const values = data.raw_data
                    .filter(row => row[indicator] !== null && row[indicator] !== undefined)
                    .sort((a, b) => a.Year - b.Year);
                
                if (values.length > 0) {
                    traces.push({
                        x: values.map(v => v.Year),
                        y: values.map(v => v[indicator]),
                        name: indicator.replace(/_/g, ' '),
                        type: 'scatter',
                        mode: 'lines+markers',
                        yaxis: 'y' + (traces.length > 0 ? traces.length + 1 : '')
                    });
                }
            });

            const layout = {
                title: `–¢—Ä–µ–Ω–¥–∏ –¥–ª—è ${data.country}`,
                xaxis: { title: '–†—ñ–∫' },
                hovermode: 'closest'
            };

            // –î–æ–¥–∞—î–º–æ –æ—Å—ñ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ–∫–∞–∑–Ω–∏–∫–∞
            indicators.forEach((indicator, index) => {
                if (index > 0) {
                    layout[`yaxis${index + 1}`] = {
                        title: indicator.replace(/_/g, ' '),
                        overlaying: 'y',
                        side: 'right'
                    };
                } else {
                    layout.yaxis = {
                        title: indicator.replace(/_/g, ' ')
                    };
                }
            });

            Plotly.newPlot('worldbank-trends-chart', traces, layout);
        }

        function updateTrendsAnalysis(data) {
            const analysisDiv = document.getElementById('trends-analysis');
            
            if (!data.trends || Object.keys(data.trends).length === 0) {
                analysisDiv.innerHTML = '<p class="text-muted">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É</p>';
                return;
            }

            let analysisHtml = `
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">–ê–Ω–∞–ª—ñ–∑ —Ç—Ä–µ–Ω–¥—ñ–≤ –¥–ª—è ${data.country}</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
            `;

            Object.entries(data.trends).forEach(([indicator, trend]) => {
                const directionClass = trend.direction === '–∑—Ä–æ—Å—Ç–∞–Ω–Ω—è' ? 'text-success' : 'text-danger';
                const directionIcon = trend.direction === '–∑—Ä–æ—Å—Ç–∞–Ω–Ω—è' ? 'fa-arrow-up' : 'fa-arrow-down';
                
                analysisHtml += `
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">${indicator.replace(/_/g, ' ')}</h6>
                                <p class="card-text">
                                    <i class="fas ${directionIcon} ${directionClass} me-1"></i>
                                    <strong>–¢—Ä–µ–Ω–¥:</strong> <span class="${directionClass}">${trend.direction}</span><br>
                                    <strong>–û—Å—Ç–∞–Ω–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è:</strong> ${trend.latest_value?.toLocaleString() || 'N/A'}<br>
                                    <strong>–†–æ–∫—ñ–≤ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ:</strong> ${trend.years_analyzed}
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            });

            analysisHtml += `
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">
                                –ü–µ—Ä—ñ–æ–¥ –∞–Ω–∞–ª—ñ–∑—É: ${data.analysis_period}
                            </small>
                        </div>
                    </div>
                </div>
            `;

            analysisDiv.innerHTML = analysisHtml;
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö
        async function loadNormalizedData() {
            console.log('–ó–∞–ø—É—Å–∫ loadNormalizedData...');
            const countries = Array.from(document.getElementById('normalized-countries').selectedOptions).map(option => option.value);
            const indicators = Array.from(document.getElementById('normalized-indicators').selectedOptions).map(option => option.value);
            const currency = document.getElementById('normalized-currency').value;
            const startYear = document.getElementById('normalized-start-year').value;
            const endYear = document.getElementById('normalized-end-year').value;
            
            console.log('–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:', { countries, indicators, currency, startYear, endYear });
            
            if (countries.length === 0 || indicators.length === 0) {
                showTabStatus('normalized', 'error', '–û–±–µ—Ä—ñ—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏', '–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏ —Ç–∞ –ø–æ–∫–∞–∑–Ω–∏–∫–∏');
                showError('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏ —Ç–∞ –ø–æ–∫–∞–∑–Ω–∏–∫–∏');
                return;
            }
            
            try {
                // –ü–æ–∫–∞–∑—É—î–º–æ —Å—Ç–∞—Ç—É—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—ñ—Å–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
                showWorldBankStatus('info', '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', '–ù–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ –¥–∞–Ω—ñ');
                showTabStatus('normalized', 'info', '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', '–ù–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ –¥–∞–Ω—ñ');
                showLoading();
                
                const params = new URLSearchParams({
                    countries: countries.join(','),
                    indicators: indicators.join(','),
                    start_year: startYear,
                    end_year: endYear,
                    currency: currency
                });
                
                const response = await fetch(`/api/worldbank/normalized?${params}`);
                const result = await response.json();
                
                if (response.ok) {
                    console.log('–û—Ç—Ä–∏–º–∞–Ω—ñ –¥–∞–Ω—ñ:', result);
                    updateNormalizedChart(result.data, result.normalization_info, currency);
                    updateNormalizedTable(result.data, result.normalization_info);
                    
                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å –¥–∞–Ω–∏—Ö (—ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —É –ø–∞–Ω–µ–ª—ñ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É)
                    if (result.data && result.data.length > 0) {
                        const firstItem = result.data[0];
                        const count = result.total_records || result.data.length;
                        if (firstItem.Country_Name === 'Ukraine' || firstItem.Country_Name === 'USA') {
                            showWorldBankStatus('warning', 
                                'API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π', 
                                '–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∑—Ä–∞–∑–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó');
                            showTabStatus('normalized', 'success', 
                                '–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 
                                `–û–±—Ä–æ–±–ª–µ–Ω–æ –∑–∞–ø–∏—Å—ñ–≤: ${count}`);
                        } else {
                            showWorldBankStatus('success', 
                                'API –ø—Ä–∞—Ü—é—î', 
                                '–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –æ—Ç—Ä–∏–º–∞–Ω–æ –∑ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É');
                            showTabStatus('normalized', 'success', 
                                '–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 
                                `–û–±—Ä–æ–±–ª–µ–Ω–æ –∑–∞–ø–∏—Å—ñ–≤: ${count}`);
                        }
                    }
                } else {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:', result);
                    showError(result.detail || '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö');
                    showWorldBankStatus('error', '–î–∞–Ω—ñ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ', '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –∑ API –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É.');
                }
            } catch (error) {
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö: ' + error.message);
                showWorldBankStatus('error', '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è', '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ: ' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫–∞ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö
        function updateNormalizedChart(data, normalizationInfo, currency) {
            console.log('updateNormalizedChart –≤–∏–∫–ª–∏–∫–∞–Ω–æ –∑:', { data, normalizationInfo, currency });
            
            if (!data || data.length === 0) {
                console.log('–î–∞–Ω—ñ –ø–æ—Ä–æ–∂–Ω—ñ, –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ–π –≥—Ä–∞—Ñ—ñ–∫');
                Plotly.newPlot('normalized-chart', [], {}, {responsive: true});
                return;
            }
            
            const traces = [];
            const countries = [...new Set(data.map(item => item.Country_Name))];
            const indicators = Object.keys(normalizationInfo);
            
            console.log('–ö—Ä–∞—ó–Ω–∏:', countries);
            console.log('–ü–æ–∫–∞–∑–Ω–∏–∫–∏:', indicators);
            
            indicators.forEach(indicator => {
                if (indicator === 'Country' || indicator === 'Country_Name' || indicator === 'Year') return;
                
                const trace = {
                    x: countries,
                    y: countries.map(country => {
                        const countryData = data.find(item => item.Country_Name === country);
                        return countryData ? countryData[indicator] : null;
                    }),
                    type: 'bar',
                    name: getIndicatorName(indicator),
                    text: countries.map(country => {
                        const countryData = data.find(item => item.Country_Name === country);
                        return countryData ? `${countryData[indicator]} ${normalizationInfo[indicator]}` : '';
                    }),
                    textposition: 'auto'
                };
                
                traces.push(trace);
            });
            
            console.log('–°—Ç–≤–æ—Ä–µ–Ω—ñ traces:', traces);
            
            const layout = {
                title: `–ù–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –µ–∫–æ–Ω–æ–º—ñ—á–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ (${currency})`,
                xaxis: { title: '–ö—Ä–∞—ó–Ω–∏' },
                yaxis: { title: '–ó–Ω–∞—á–µ–Ω–Ω—è' },
                barmode: 'group',
                responsive: true
            };
            
            Plotly.newPlot('normalized-chart', traces, layout, {responsive: true});
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö
        function updateNormalizedTable(data, normalizationInfo) {
            const tableDiv = document.getElementById('normalized-table');
            
            if (!data || data.length === 0) {
                tableDiv.innerHTML = '<div class="alert alert-warning">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</div>';
                return;
            }
            
            let html = '<div class="card"><div class="card-header"><h6 class="mb-0">–ù–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ</h6></div><div class="card-body"><div class="table-responsive"><table class="table table-striped"><thead><tr>';
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ
            html += '<th>–ö—Ä–∞—ó–Ω–∞</th><th>–†—ñ–∫</th>';
            Object.keys(normalizationInfo).forEach(indicator => {
                html += `<th>${getIndicatorName(indicator)} (${normalizationInfo[indicator]})</th>`;
            });
            html += '</tr></thead><tbody>';
            
            // –î–∞–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ
            data.forEach(row => {
                html += `<tr><td>${row.Country_Name}</td><td>${row.Year}</td>`;
                Object.keys(normalizationInfo).forEach(indicator => {
                    const raw = row[indicator];
                    let valueText = 'N/A';
                    if (raw !== null && raw !== undefined && raw !== '') {
                        const num = typeof raw === 'number' ? raw : parseFloat(raw);
                        valueText = isNaN(num) ? String(raw) : num.toFixed(2);
                    }
                    html += `<td>${valueText}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table></div></div></div>';
            tableDiv.innerHTML = html;
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–Ω–∞–ª—ñ–∑—É –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è
        async function loadEconomicHealth() {
            const countries = Array.from(document.getElementById('health-countries').selectedOptions).map(option => option.value);
            const startYear = document.getElementById('health-start-year').value;
            const endYear = document.getElementById('health-end-year').value;
            
            if (countries.length === 0) {
                showTabStatus('health', 'error', '–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏', '–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É');
                showError('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É');
                return;
            }
            
            try {
                // –ü–æ–∫–∞–∑—É—î–º–æ —Å—Ç–∞—Ç—É—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—ñ—Å–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
                showWorldBankStatus('info', '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', '–ê–Ω–∞–ª—ñ–∑—É—î–º–æ –µ–∫–æ–Ω–æ–º—ñ—á–Ω–µ –∑–¥–æ—Ä–æ–≤\'—è');
                showTabStatus('health', 'info', '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', '–ê–Ω–∞–ª—ñ–∑—É—î–º–æ –µ–∫–æ–Ω–æ–º—ñ—á–Ω–µ –∑–¥–æ—Ä–æ–≤\'—è');
                showLoading();
                
                const params = new URLSearchParams({
                    countries: countries.join(','),
                    start_year: startYear,
                    end_year: endYear
                });
                
                const response = await fetch(`/api/worldbank/economic-health?${params}`);
                const result = await response.json();
                
                if (response.ok) {
                    updateHealthChart(result.analysis);
                    updateHealthAnalysis(result.analysis, result.methodology);
                    
                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å –¥–∞–Ω–∏—Ö (—ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —É –ø–∞–Ω–µ–ª—ñ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É)
                    if (result.analysis && Object.keys(result.analysis).length > 0) {
                        const firstCountry = Object.values(result.analysis)[0];
                        const count = Object.keys(result.analysis).length;
                        if (firstCountry.country_name === 'Ukraine' || firstCountry.country_name === 'USA') {
                            showWorldBankStatus('warning', 
                                'API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π', 
                                '–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∑—Ä–∞–∑–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó');
                            showTabStatus('health', 'success', 
                                '–ê–Ω–∞–ª—ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 
                                `–û–ø—Ä–∞—Ü—å–æ–≤–∞–Ω–æ –∫—Ä–∞—ó–Ω: ${count}`);
                        } else {
                            showWorldBankStatus('success', 
                                'API –ø—Ä–∞—Ü—é—î', 
                                '–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –æ—Ç—Ä–∏–º–∞–Ω–æ –∑ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É');
                            showTabStatus('health', 'success', 
                                '–ê–Ω–∞–ª—ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 
                                `–û–ø—Ä–∞—Ü—å–æ–≤–∞–Ω–æ –∫—Ä–∞—ó–Ω: ${count}`);
                        }
                    }
                } else {
                    showError(result.detail || "–ü–æ–º–∏–ª–∫–∞ –∞–Ω–∞–ª—ñ–∑—É –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è");
                    showWorldBankStatus('error', '–î–∞–Ω—ñ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ', '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑ –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤\'—è.');
                }
            } catch (error) {
                showError("–ü–æ–º–∏–ª–∫–∞ –∞–Ω–∞–ª—ñ–∑—É –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è: " + error.message);
                showWorldBankStatus('error', '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è', '–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –µ–∫–æ–Ω–æ–º—ñ—á–Ω–µ –∑–¥–æ—Ä–æ–≤\'—è: ' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫–∞ –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è
        function updateHealthChart(analysis) {
            if (!analysis || Object.keys(analysis).length === 0) {
                Plotly.newPlot('health-chart', [], {}, {responsive: true});
                return;
            }
            
            const countries = Object.keys(analysis).map(code => analysis[code].country_name);
            const scores = Object.keys(analysis).map(code => analysis[code].health_score);
            const levels = Object.keys(analysis).map(code => analysis[code].health_level);
            
            // –ö–æ–ª—å–æ—Ä–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä—ñ–≤–Ω—è –∑–¥–æ—Ä–æ–≤'—è (–ø—ñ–¥—Ç—Ä–∏–º–∫–∞ UA/EN)
            const colors = levels.map(level => {
                switch(level) {
                    case '–í—ñ–¥–º—ñ–Ω–Ω–∏–π':
                    case 'Excellent':
                        return '#28a745'; // green
                    case '–î–æ–±—Ä–∏–π':
                    case 'Good':
                        return '#17a2b8'; // teal
                    case '–°–µ—Ä–µ–¥–Ω—ñ–π':
                    case 'Medium':
                        return '#ffc107'; // yellow
                    case '–ü–æ–≥–∞–Ω–∏–π':
                    case 'Poor':
                        return '#fd7e14'; // orange
                    case '–ö—Ä–∏—Ç–∏—á–Ω–∏–π':
                    case 'Critical':
                        return '#dc3545'; // red
                    case 'No Data':
                        return '#6c757d'; // gray
                    default:
                        return '#6c757d';
                }
            });
            
            const trace = {
                x: countries,
                y: scores,
                type: 'bar',
                marker: { color: colors },
                text: levels,
                textposition: 'auto'
            };
            
            const layout = {
                title: "–Ü–Ω–¥–µ–∫—Å –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è –∫—Ä–∞—ó–Ω",
                xaxis: { title: '–ö—Ä–∞—ó–Ω–∏' },
                yaxis: { title: '–ë–∞–ª (0-100)', range: [0, 100] },
                responsive: true
            };
            
            Plotly.newPlot('health-chart', [trace], layout, {responsive: true});
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–Ω–∞–ª—ñ–∑—É –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è
        function updateHealthAnalysis(analysis, methodology) {
            const analysisDiv = document.getElementById('health-analysis');
            
            if (!analysis || Object.keys(analysis).length === 0) {
                analysisDiv.innerHTML = '<div class="alert alert-warning">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É</div>';
                return;
            }
            
            let html = '<div class="row">';
            
            // –°–æ—Ä—Ç—É—î–º–æ –∫—Ä–∞—ó–Ω–∏ –∑–∞ –±–∞–ª–æ–º
            const sortedCountries = Object.keys(analysis).sort((a, b) => analysis[b].health_score - analysis[a].health_score);
            
            sortedCountries.forEach(countryCode => {
                const country = analysis[countryCode];
                const levelClass = getHealthLevelClass(country.health_level);
                
                html += `
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">${country.country_name}</h6>
                                <span class="badge ${levelClass}">${country.health_level}</span>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <strong>–ó–∞–≥–∞–ª—å–Ω–∏–π –±–∞–ª:</strong> ${country.health_score}/100
                                </div>
                                <div class="progress mb-2" style="height: 20px;">
                                    <div class="progress-bar ${levelClass.replace('bg-', 'bg-')}" 
                                         style="width: ${country.health_score}%">
                                        ${country.health_score}%
                                    </div>
                                </div>
                                <div class="small">
                `;
                
                // –ü–æ–∫–∞–∑–Ω–∏–∫–∏
                Object.entries(country.indicators).forEach(([indicator, data]) => {
                    html += `
                        <div class="d-flex justify-content-between">
                            <span>${getIndicatorName(indicator)}:</span>
                            <span>${data.value.toFixed(2)} (${data.score}/100)</span>
                        </div>
                    `;
                });
                
                html += `
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // –î–æ–¥–∞—î–º–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—é
            html += `
                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="mb-0">–ú–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—è –æ—Ü—ñ–Ω–∫–∏</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
            `;
            
            Object.entries(methodology).forEach(([indicator, description]) => {
                html += `
                    <div class="col-md-6 mb-2">
                        <strong>${getIndicatorName(indicator)}:</strong> ${description}
                    </div>
                `;
            });
            
            html += '</div></div></div>';
            
            analysisDiv.innerHTML = html;
        }
        
        // –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–ª–∞—Å—É CSS –¥–ª—è —Ä—ñ–≤–Ω—è –∑–¥–æ—Ä–æ–≤'—è
        function getHealthLevelClass(level) {
            switch(level) {
                case 'Excellent': return 'bg-success';
                case 'Good': return 'bg-info';
                case 'Medium': return 'bg-warning';
                case 'Poor': return 'bg-danger';
                case 'Critical': return 'bg-dark';
                case 'No Data': return 'bg-secondary';
                default: return 'bg-secondary';
            }
        }
        
        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –¥–∞–Ω–∏—Ö (–≥–ª–æ–±–∞–ª—å–Ω–∏–π)
        function showDataStatus(type, status, details = '') {
            const alert = document.getElementById('data-status-alert');
            const statusText = document.getElementById('data-status-text');
            const statusDetails = document.getElementById('data-status-details');
            
            // –í–∏–¥–∞–ª—è—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –∫–ª–∞—Å–∏
            alert.className = 'alert d-flex align-items-center';
            
            // –î–æ–¥–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –∫–ª–∞—Å —Ç–∞ —ñ–∫–æ–Ω–∫—É
            switch(type) {
                case 'success':
                    alert.classList.add('alert-success');
                    alert.querySelector('i').className = 'fas fa-check-circle me-2';
                    break;
                case 'warning':
                    alert.classList.add('alert-warning');
                    alert.querySelector('i').className = 'fas fa-exclamation-triangle me-2';
                    break;
                case 'error':
                    alert.classList.add('alert-danger');
                    alert.querySelector('i').className = 'fas fa-exclamation-circle me-2';
                    break;
                case 'info':
                default:
                    alert.classList.add('alert-info');
                    alert.querySelector('i').className = 'fas fa-info-circle me-2';
                    break;
            }
            
            statusText.textContent = status;
            statusDetails.textContent = details;
            alert.style.display = 'flex';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏—Ö–æ–≤—É—î–º–æ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è —É—Å–ø—ñ—à–Ω–∏—Ö —Å—Ç–∞—Ç—É—Å—ñ–≤
            if (type === 'success') {
                setTimeout(() => {
                    alert.style.display = 'none';
                }, 5000);
            }
        }
        
        function hideDataStatus() {
            document.getElementById('data-status-alert').style.display = 'none';
        }
        
        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É —É –ø–∞–Ω–µ–ª—ñ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É
        function showWorldBankStatus(type, status, details = '', tabId = null) {
            // –ó–∞–≥–∞–ª—å–Ω–∏–π API —Å—Ç–∞—Ç—É—Å (—Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ä–µ–∞–ª—å–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π, –Ω–µ –¥–ª—è –ø—ñ–¥–∫–∞–∑–æ–∫)
            if (type !== 'info' || (status !== '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏"' && 
                                   status !== '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–æ—Ä—ñ–≤–Ω—è—Ç–∏"' && 
                                   status !== '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏"' && 
                                   status !== '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ù–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ"' && 
                                   status !== '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–¥–æ—Ä–æ–≤\'—è"')) {
                
                const apiAlert = document.getElementById('worldbank-api-status-alert');
                const apiStatusText = document.getElementById('worldbank-api-status-text');
                const apiStatusDetails = document.getElementById('worldbank-api-status-details');

                apiAlert.className = 'alert d-flex align-items-center mb-3';

                switch(type) {
                    case 'success':
                        apiAlert.classList.add('alert-success');
                        apiAlert.querySelector('i').className = 'fas fa-check-circle me-2';
                        break;
                    case 'warning':
                        apiAlert.classList.add('alert-warning');
                        apiAlert.querySelector('i').className = 'fas fa-exclamation-triangle me-2';
                        break;
                    case 'error':
                        apiAlert.classList.add('alert-danger');
                        apiAlert.querySelector('i').className = 'fas fa-exclamation-circle me-2';
                        break;
                    case 'info':
                    default:
                        apiAlert.classList.add('alert-info');
                        apiAlert.querySelector('i').className = 'fas fa-info-circle me-2';
                        break;
                }

                apiStatusText.textContent = status;
                apiStatusDetails.textContent = details;
                apiAlert.style.display = 'flex';

                if (type === 'success') {
                    setTimeout(() => {
                        apiAlert.style.display = 'none';
                    }, 5000);
                }
            }

            // –°—Ç–∞—Ç—É—Å –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –≤–∫–ª–∞–¥–∫–∏
            if (tabId) {
                const tabAlert = document.getElementById(`${tabId}-status-alert`);
                const tabStatusText = document.getElementById(`${tabId}-status-text`);
                const tabStatusDetails = document.getElementById(`${tabId}-status-details`);
                
                if (tabAlert && tabStatusText && tabStatusDetails) {
                    tabAlert.className = 'alert d-flex align-items-center mb-3';
                    
                    switch(type) {
                        case 'success':
                            tabAlert.classList.add('alert-success');
                            tabAlert.querySelector('i').className = 'fas fa-check-circle me-2';
                            break;
                        case 'warning':
                            tabAlert.classList.add('alert-warning');
                            tabAlert.querySelector('i').className = 'fas fa-exclamation-triangle me-2';
                            break;
                        case 'error':
                            tabAlert.classList.add('alert-danger');
                            tabAlert.querySelector('i').className = 'fas fa-exclamation-circle me-2';
                            break;
                        case 'info':
                        default:
                            tabAlert.classList.add('alert-light');
                            tabAlert.querySelector('i').className = 'fas fa-info-circle me-2';
                            break;
                    }
                    
                    tabStatusText.textContent = status;
                    tabStatusDetails.textContent = details;
                    tabAlert.style.display = 'flex';
                }
            }
        }

        function hideWorldBankStatus() {
            document.getElementById('worldbank-api-status-alert').style.display = 'none';
        }

        // –ü–æ–∫–∞–∑—É—î–º–æ –ø—ñ–¥–∫–∞–∑–∫–∏ –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        function showTabHints() {
            // –ü–æ–∫–∞–∑–Ω–∏–∫–∏
            showTabStatus('indicators', 'info', '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏"', '–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏, –ø–æ–∫–∞–∑–Ω–∏–∫–∏ —Ç–∞ –ø–µ—Ä—ñ–æ–¥');
            
            // –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
            showTabStatus('comparison', 'info', '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–æ—Ä—ñ–≤–Ω—è—Ç–∏"', '–û–±–µ—Ä—ñ—Ç—å –ø–æ–∫–∞–∑–Ω–∏–∫, –∫—Ä–∞—ó–Ω–∏ —Ç–∞ —Ä–æ–∫—ñ–≤ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É');
            
            // –¢—Ä–µ–Ω–¥–∏
            showTabStatus('trends', 'info', '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏"', '–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω—É, –ø–æ–∫–∞–∑–Ω–∏–∫–∏ —Ç–∞ —Ä–æ–∫—ñ–≤ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É');
            
            // –ù–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ
            showTabStatus('normalized', 'info', '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ù–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ"', '–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏, –ø–æ–∫–∞–∑–Ω–∏–∫–∏, –≤–∞–ª—é—Ç—É —Ç–∞ –ø–µ—Ä—ñ–æ–¥');
            
            // –ï–∫–æ–Ω–æ–º—ñ—á–Ω–µ –∑–¥–æ—Ä–æ–≤'—è
            showTabStatus('health', 'info', '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–¥–æ—Ä–æ–≤\'—è"', '–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω–∏ —Ç–∞ –ø–µ—Ä—ñ–æ–¥ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤\'—è');
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞–Ω API –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        async function checkAPIStatus() {
            try {
                // –ü–æ–∫–∞–∑—É—î–º–æ —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
                showWorldBankStatus('info', '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ API...', '–¢–µ—Å—Ç—É—î–º–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É');
                
                // –†–æ–±–∏–º–æ —Ç–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø–∏—Ç –¥–æ API
                const response = await fetch('/api/worldbank/indicators?countries=UA&indicators=GDP&start_year=2023&end_year=2023');
                const result = await response.json();
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ —Ä–µ–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ
                if (result && result.data && result.data.length > 0) {
                    const firstItem = result.data[0];
                    // –Ø–∫—â–æ —Ü–µ –∑—Ä–∞–∑–∫–æ–≤—ñ –¥–∞–Ω—ñ (Ukraine –∑ –ø–µ–≤–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏)
                    if (firstItem.Country_Name === 'Ukraine' && firstItem.GDP === 200) {
                        showWorldBankStatus('warning', 'API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π', '–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∑—Ä–∞–∑–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó');
                    } else {
                        showWorldBankStatus('success', 'API –ø—Ä–∞—Ü—é—î', '–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É —É—Å–ø—ñ—à–Ω–µ');
                    }
                } else {
                    showWorldBankStatus('warning', 'API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π', '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∑ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É');
                }
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ API:', error);
                showWorldBankStatus('error', 'API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π', '–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É');
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É —Å—Ç–∞—Ç—É—Å—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –≤–∫–ª–∞–¥–∫–∏
        function showTabStatus(tabId, type, status, details) {
            const tabAlert = document.getElementById(`${tabId}-status-alert`);
            const tabStatusText = document.getElementById(`${tabId}-status-text`);
            const tabStatusDetails = document.getElementById(`${tabId}-status-details`);
            
            if (tabAlert && tabStatusText && tabStatusDetails) {
                tabAlert.className = 'alert d-flex align-items-center mb-3';
                tabAlert.classList.add('alert-light');
                tabAlert.querySelector('i').className = 'fas fa-info-circle me-2';
                
                tabStatusText.textContent = status;
                tabStatusDetails.textContent = details;
                tabAlert.style.display = 'flex';
            }
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –¥–∞–Ω–∏—Ö –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É
        async function checkWorldBankDataStatus() {
            try {
                const response = await fetch('/api/worldbank/indicators?start_year=2020&end_year=2023');
                const payload = await response.json();
                const rows = (payload && payload.data) ? payload.data : payload;
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –¥–∞–Ω—ñ –≤–∏–≥–ª—è–¥–∞—é—Ç—å —è–∫ –∑—Ä–∞–∑–∫–æ–≤—ñ
                if (rows && rows.length > 0) {
                    const firstItem = rows[0];
                    // –ó—Ä–∞–∑–∫–æ–≤—ñ –¥–∞–Ω—ñ –º–∞—é—Ç—å –ø–µ–≤–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
                    if (firstItem.Country_Name === 'Ukraine' || firstItem.Country_Name === 'USA') {
                        showWorldBankStatus('warning', 
                            '–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∑—Ä–∞–∑–∫–æ–≤—ñ –¥–∞–Ω—ñ', 
                            'API –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –í—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ.');
                    } else {
                        showWorldBankStatus('success', 
                            '–î–∞–Ω—ñ –∑ API –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É', 
                            '–û—Ç—Ä–∏–º–∞–Ω–æ —Ä–µ–∞–ª—å–Ω—ñ –µ–∫–æ–Ω–æ–º—ñ—á–Ω—ñ –¥–∞–Ω—ñ –∑ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞.');
                    }
                } else {
                    showWorldBankStatus('error', 
                        '–î–∞–Ω—ñ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ', 
                        '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –∑ API –°–≤—ñ—Ç–æ–≤–æ–≥–æ –±–∞–Ω–∫—É.');
                }
            } catch (error) {
                showWorldBankStatus('error', 
                    '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è', 
                    '–ù–µ –≤–¥–∞–ª–æ—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –¥–∞–Ω–∏—Ö: ' + error.message);
            }
        }
    </script>
</body>
</html>
